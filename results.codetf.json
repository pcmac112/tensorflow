{
  "vendor": "pixee",
  "tool": "pixee-cli",
  "version": "0.5.5",
  "commandLine": "/opt/homebrew/bin/pixee fix --apply-fixes",
  "elapsed": 112578,
  "results": [
    {
      "codemod": "pixee:python/add-requests-timeouts",
      "summary": "Add timeout to `requests` calls",
      "description": "Many developers will be surprised to learn that `requests` library calls do not include timeouts by default. This means that an attempted request could hang indefinitely if no connection is established or if no data is received from the server. \n\nThe [requests documentation](https://requests.readthedocs.io/en/latest/user/advanced/#timeouts) suggests that most calls should explicitly include a `timeout` parameter. This codemod adds a default timeout value in order to set an upper bound on connection times and ensure that requests connect or fail in a timely manner. This value also ensures the connection will timeout if the server does not respond with data within a reasonable amount of time. \n\nWhile timeout values will be application dependent, we believe that this codemod adds a reasonable default that serves as an appropriate ceiling for most situations. \n\nOur changes look like the following:\n```diff\n import requests\n \n- requests.get(\"http://example.com\")\n+ requests.get(\"http://example.com\", timeout=60)\n```\n",
      "references": [
        {
          "url": "https://docs.python-requests.org/en/master/user/quickstart/#timeouts",
          "description": "https://docs.python-requests.org/en/master/user/quickstart/#timeouts"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": [
        {
          "path": "tensorflow/python/ops/numpy_ops/np_utils.py",
          "diff": "--- \n+++ \n@@ -352,7 +352,7 @@\n         # Imports locally because some builds may not have `requests`\n         import requests  # pylint: disable=g-import-not-at-top\n \n-        r = requests.head(url)\n+        r = requests.head(url, timeout=60)\n         if r.status_code != 200:\n           raise ValueError(\n               f'Check link failed at [{url}] with status code {r.status_code}. '\n",
          "changes": [
            {
              "lineNumber": "355",
              "description": "Add timeout to `requests` call",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/tools/grpc_tpu_worker.py",
          "diff": "--- \n+++ \n@@ -42,7 +42,7 @@\n       '/v1/instance/attributes/{}'.format(key),\n       headers={\n           'Metadata-Flavor': 'Google'\n-      }).text\n+      }, timeout=60).text\n \n \n def get_host_ip():\n@@ -50,7 +50,7 @@\n       'http://metadata.google.internal/computeMetadata/v1/instance/network-interfaces/0/ip',\n       headers={\n           'Metadata-Flavor': 'Google'\n-      }).text\n+      }, timeout=60).text\n \n \n def setup_env_vars():\n",
          "changes": [
            {
              "lineNumber": "40",
              "description": "Add timeout to `requests` call",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "49",
              "description": "Add timeout to `requests` call",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:python/bad-lock-with-statement",
      "summary": "Separate Lock Instantiation from `with` Call",
      "description": "This codemod separates creating a threading lock instance from calling it as a context manager. Calling `with threading.Lock()` does not have the effect you would expect. The lock is not acquired. Instead, to correctly acquire a lock, create the instance separately, before calling it as a context manager.\n\nThe change will apply to any of these `threading` classes: `Lock`, `RLock`, `Condition`, `Semaphore`, and `BoundedSemaphore`.\n\nThe change looks like this:\n\n```diff\n  import threading\n- with threading.Lock():\n+ lock = threading.Lock()\n+ with lock:\n     ...\n```\n",
      "references": [
        {
          "url": "https://pylint.pycqa.org/en/latest/user_guide/messages/warning/useless-with-lock.",
          "description": "https://pylint.pycqa.org/en/latest/user_guide/messages/warning/useless-with-lock."
        },
        {
          "url": "https://docs.python.org/3/library/threading.html#using-locks-conditions-and-semaphores-in-the-with-statement",
          "description": "https://docs.python.org/3/library/threading.html#using-locks-conditions-and-semaphores-in-the-with-statement"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/combine-startswith-endswith",
      "summary": "Simplify Boolean Expressions Using `startswith` and `endswith`",
      "description": "Many developers are not necessarily aware that the `startswith` and `endswith` methods of `str` objects can accept a tuple of strings to match. This means that there is a lot of code that uses boolean expressions such as `x.startswith('foo') or x.startswith('bar')` instead of the simpler expression `x.startswith(('foo', 'bar'))`.\n\nThis codemod simplifies the boolean expressions where possible which leads to cleaner and more concise code.\n\nThe changes from this codemod look like this:\n\n```diff\n  x = 'foo'\n- if x.startswith(\"foo\") or x.startswith(\"bar\"):\n+ if x.startswith((\"foo\", \"bar\")):\n     ...\n```\n",
      "references": [],
      "properties": {},
      "failedFiles": [],
      "changeset": [
        {
          "path": "tensorflow/python/tools/grpc_tpu_worker.py",
          "diff": "--- \n+++ \n@@ -87,8 +87,7 @@\n \n   # If v4 TPU don't set any topology related flags,\n   # libtpu will set these values.\n-  if not (accelerator_type.startswith('v4-') or\n-          accelerator_type.startswith('v5')):\n+  if not accelerator_type.startswith(('v4-', 'v5')):\n     os.environ['TPU_CHIPS_PER_HOST_BOUNDS'] = '2,2,1'\n     os.environ['TPU_HOST_BOUNDS'] = accelerator_type_to_host_bounds[\n         accelerator_type]\n",
          "changes": [
            {
              "lineNumber": "90",
              "description": "Use tuple of matches instead of boolean expression",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:python/django-debug-flag-on",
      "summary": "Disable Django Debug Mode",
      "description": "This codemod will flip django's `DEBUG` flag to `False` if it's `True` on the `settings.py` file within django's default directory structure.\n\nHaving the debug flag on may result in sensitive information exposure. When an exception occurs while the `DEBUG` flag in on, it will dump metadata of your environment, including the settings module. The attacker can purposefully request a non-existing url to trigger an exception and gather information about your system.\n\n```diff\n- DEBUG = True\n+ DEBUG = False\n```\n",
      "references": [
        {
          "url": "https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure",
          "description": "https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure"
        },
        {
          "url": "https://docs.djangoproject.com/en/4.2/ref/settings/#std-setting-DEBUG",
          "description": "https://docs.djangoproject.com/en/4.2/ref/settings/#std-setting-DEBUG"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/django-json-response-type",
      "summary": "Set content type to `application/json` for `django.http.HttpResponse` with JSON data",
      "description": "The default `content_type` for `HttpResponse` in Django is `'text/html'`. This is true even when the response contains JSON data.\nIf the JSON contains (unsanitized) user-supplied input, a malicious user may supply HTML code which leaves the application vulnerable to cross-site scripting (XSS). \nThis fix explicitly sets the response type to `application/json` when the response body is JSON data to avoid this vulnerability. Our changes look something like this:\n\n```diff\nfrom django.http import HttpResponse\nimport json\n\ndef foo(request):\n    json_response = json.dumps({ \"user_input\": request.GET.get(\"input\") })\n-    return HttpResponse(json_response)\n+    return HttpResponse(json_response, content_type=\"application/json\")\n```\n",
      "references": [
        {
          "url": "https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpResponse.__init__",
          "description": "https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpResponse.__init__"
        },
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html#output-encoding-for-javascript-contexts",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html#output-encoding-for-javascript-contexts"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/django-receiver-on-top",
      "summary": "Ensure Django @receiver is the first decorator",
      "description": "Django uses signals to notify and handle actions that happens elsewhere in the application. You can define a response to a given signal by decorating a function with the `@receiver(signal)` decorator. The order in which the decorators are declared for this function is important. If the `@receiver` decorator is not on top, any decorators before it will be ignored. \nOur changes look something like this:\n\n```diff\nfrom django.dispatch import receiver\nfrom django.views.decorators.csrf import csrf_exempt\nfrom django.core.signals import request_finished\n\n+@receiver(request_finished)\n@csrf_exempt\n-@receiver(request_finished)\ndef foo():\n    pass\n```\n",
      "references": [
        {
          "url": "https://docs.djangoproject.com/en/4.1/topics/signals/",
          "description": "https://docs.djangoproject.com/en/4.1/topics/signals/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/django-session-cookie-secure-off",
      "summary": "Secure Setting for Django `SESSION_COOKIE_SECURE` flag",
      "description": "This codemod will set django's `SESSION_COOKIE_SECURE` flag to `True` if it's `False` or missing on the `settings.py` file within django's default directory structure.\n\n```diff\n+ SESSION_COOKIE_SECURE = True\n```\n\nSetting this flag on ensures that the session cookies are only sent under an HTTPS connection. Leaving this flag off may enable an attacker to use a sniffer to capture the unencrypted session cookie and hijack the user's session.\n",
      "references": [
        {
          "url": "https://owasp.org/www-community/controls/SecureCookieAttribute",
          "description": "https://owasp.org/www-community/controls/SecureCookieAttribute"
        },
        {
          "url": "https://docs.djangoproject.com/en/4.2/ref/settings/#session-cookie-secure",
          "description": "https://docs.djangoproject.com/en/4.2/ref/settings/#session-cookie-secure"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/enable-jinja2-autoescape",
      "summary": "Enable Jinja2 Autoescape",
      "description": "This codemod enables autoescaping of HTML content in `jinja2`. Unfortunately, the jinja2 default behavior is to not autoescape when rendering templates, which makes your applications potentially vulnerable to Cross-Site Scripting (XSS) attacks.\n\nOur codemod checks if you forgot to enable autoescape or if you explicitly disabled it. The change looks as follows:\n\n```diff\n  from jinja2 import Environment\n\n- env = Environment()\n- env = Environment(autoescape=False, loader=some_loader)\n+ env = Environment(autoescape=True)\n+ env = Environment(autoescape=True, loader=some_loader)\n  ...\n```\n",
      "references": [
        {
          "url": "https://owasp.org/www-community/attacks/xss/",
          "description": "https://owasp.org/www-community/attacks/xss/"
        },
        {
          "url": "https://jinja.palletsprojects.com/en/3.1.x/api/#autoescaping",
          "description": "https://jinja.palletsprojects.com/en/3.1.x/api/#autoescaping"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/exception-without-raise",
      "summary": "Ensure bare exception statements are raised",
      "description": "This codemod fixes cases where an exception is referenced by itself in a statement without being raised. This most likely indicates a bug: you probably meant to actually raise the exception. \n\nOur changes look something like this:\n```diff\ntry:\n-   ValueError\n+   raise ValueError\nexcept:\n    pass\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/tutorial/errors.html#raising-exceptions",
          "description": "https://docs.python.org/3/tutorial/errors.html#raising-exceptions"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/fix-assert-tuple",
      "summary": "Fix `assert` on Non-Empty Tuple Literal",
      "description": "An assertion on a non-empty tuple will always evaluate to `True`. This means that `assert` statements involving non-empty tuple literals are likely unintentional and should be rewritten. This codemod rewrites the original `assert` statement by creating a new `assert` for each item in the original tuple.\n\nThe changes from this codemod look like this:\n\n```diff\n- assert (1 == 1, 2 == 2)\n+ assert 1 == 1\n+ assert 2 == 2\n```\n",
      "references": [],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/fix-async-task-instantiation",
      "summary": "Use High-Level `asyncio` API Functions to Create Tasks",
      "description": "The `asyncio` [documentation](https://docs.python.org/3/library/asyncio-task.html#asyncio.Task) explicitly discourages manual instantiation of a `Task` instance and instead recommends calling `create_task`. This keeps your code in line with recommended best practices and promotes maintainability.\n\nOur changes look like the following:\n```diff\n import asyncio\n\n- task = asyncio.Task(my_coroutine(), name=\"my task\")\n+ task = asyncio.create_task(my_coroutine(), name=\"my task\")\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/asyncio-task.html#asyncio.Task",
          "description": "https://docs.python.org/3/library/asyncio-task.html#asyncio.Task"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/fix-deprecated-abstractproperty",
      "summary": "Replace deprecated abstractproperty",
      "description": "The `@abstractproperty` decorator from `abc` has been [deprecated](https://docs.python.org/3/library/abc.html#abc.abstractproperty) since Python 3.3. This is because it's possible to use `@property` in combination with `@abstractmethod`. \n\nOur changes look like the following:\n```diff\n import abc\n\n class Foo:\n-   @abc.abstractproperty\n+   @property\n+   @abc.abstractmethod\n    def bar():\n        ...\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/abc.html#abc.abstractproperty",
          "description": "https://docs.python.org/3/library/abc.html#abc.abstractproperty"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/fix-deprecated-logging-warn",
      "summary": "Replace Deprecated `logging.warn`",
      "description": "The `warn` method from `logging` has been [deprecated](https://docs.python.org/3/library/logging.html#logging.Logger.warning) in favor of `warning` since Python 3.3. Since the old method `warn` has been retained for a long time, there are a lot of developers that are unaware of this change and consequently a lot of code using the older method.\n\nOur changes look like the following:\n```diff\n import logging\n\n- logging.warn(\"hello\")\n+ logging.warning(\"hello\")\n ...\n log = logging.getLogger(\"my logger\")\n- log.warn(\"hello\")\n+ log.warning(\"hello\") \n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/logging.html#logging.Logger.warning",
          "description": "https://docs.python.org/3/library/logging.html#logging.Logger.warning"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/fix-empty-sequence-comparison",
      "summary": "Replace Comparisons to Empty Sequence with Implicit Boolean Comparison",
      "description": "Empty sequences in Python always evaluate to `False`. This means that comparison expressions that use empty sequences can sometimes be simplified. In these cases no explicit comparison is required: instead we can rely on the [truth value](https://docs.python.org/3/library/stdtypes.html#truth-value-testing) of the object under comparison. This is sometimes referred to as \"implicit\" comparison. Using implicit boolean comparison expressions is considered best practice and can lead to better code.\n\nOur changes look like the following:\n```diff\n x = [1]\n\n- if x != []:\n+ if x:\n    pass \n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/stdtypes.html#truth-value-testing",
          "description": "https://docs.python.org/3/library/stdtypes.html#truth-value-testing"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/fix-file-resource-leak",
      "summary": "Automatically Close Resources",
      "description": "This codemod wraps assignments of `open` calls in a with statement. Without explicit closing, these resources will be \"leaked\" and won't be re-claimed until garbage collection. In situations where these resources are leaked rapidly (either through malicious repetitive action or unusually spiky usage), connection pool or file handle exhaustion will occur. These types of failures tend to be catastrophic, resulting in downtime and many times affect downstream applications.\n\nOur changes look something like this:\n\n```diff\nimport tempfile\npath = tempfile.NamedTemporaryFile().name\n-file = open(path, 'w', encoding='utf-8')\n-file.write('Hello World')\n+with open(path, 'w', encoding='utf-8') as file:\n+   file.write('Hello World')\n```\n",
      "references": [
        {
          "url": "https://cwe.mitre.org/data/definitions/772.html",
          "description": "https://cwe.mitre.org/data/definitions/772.html"
        },
        {
          "url": "https://cwe.mitre.org/data/definitions/404.html",
          "description": "https://cwe.mitre.org/data/definitions/404.html"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/fix-mutable-params",
      "summary": "Replace Mutable Default Parameters",
      "description": "Using mutable values for default arguments is not a safe practice.\nLook at the following very simple example code:\n\n```python\ndef foo(x, y=[]):\n    y.append(x)\n    print(y)\n```\n\nThe function `foo` doesn't do anything very interesting; it just prints the result of `x` appended to `y`. Naively we might expect this to simply print an array containing only `x` every time `foo` is called, like this:\n\n```python\n>>> foo(1)\n[1]\n>>> foo(2)\n[2]\n```\n\nBut that's not what happens!\n\n```python\n>>> foo(1)\n[1]\n>>> foo(2)\n[1, 2]\n```\n\nThe value of `y` is preserved between calls! This might seem surprising, and it is. It's due to the way that scope works for function arguments in Python.\n\nThe result is that any default argument value will be preserved between function calls. This is problematic for *mutable* types, including things like `list`, `dict`, and `set`.\n\nRelying on this behavior is unpredictable and generally considered to be unsafe. Most of us who write code like this were not anticipating the surprising behavior, so it's best to fix it.\n\nOur codemod makes an update that looks like this:\n```diff\n- def foo(x, y=[]):\n+ def foo(x, y=None):\n+   y = [] if y is None else y\n    y.append(x)\n    print(y)\n```\n\nUsing `None` is a much safer default. The new code checks if `None` is passed, and if so uses an empty `list` for the value of `y`. This will guarantee consistent and safe behavior between calls.\n",
      "references": [],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/flask-enable-csrf-protection",
      "summary": "Enable CSRF protection globally for a Flask app.",
      "description": "Cross-site request forgery (CSRF) is an attack where a user is tricked by a malicious agent to submit a unintended request (e.g login requests). A common way to mitigate this issue is to embed an additional token into requests to identify requests from unauthorized locations.\n\nFlask views using `FlaskForm` have CSRF protection enabled by default. However other views may use AJAX to perform unsafe HTTP methods. FlaskWTF provides a way to enable CSRF protection globally for all views of a Flask app.\n\nThe changes in this codemod may require manual additions to maintain proper functionality. You need to setup either a flask `SECRET_KEY` or a `WTF_CSRF_SECRET_KEY` in you app configuration and adjust any views with HTML forms and javascript requests to include the CSRF token. See the [FlaskWTF docs](https://flask-wtf.readthedocs.io/en/1.2.x/csrf/) for examples on how to do it.\n\nOur changes look something like this:\n\n```diff\nfrom flask import Flask\n+from flask_wtf.csrf import CSRFProtect\n\napp = Flask(__name__)\n+csrf_app = CSRFProtect(app)\n```\n",
      "references": [
        {
          "url": "https://owasp.org/www-community/attacks/csrf",
          "description": "https://owasp.org/www-community/attacks/csrf"
        },
        {
          "url": "https://flask-wtf.readthedocs.io/en/1.2.x/csrf/",
          "description": "https://flask-wtf.readthedocs.io/en/1.2.x/csrf/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/flask-json-response-type",
      "summary": "Set content type to `application/json` for `flask.make_response` with JSON data",
      "description": "The default `mimetype` for `make_response` in Flask is `'text/html'`. This is true even when the response contains JSON data.\nIf the JSON contains (unsanitized) user-supplied input, a malicious user may supply HTML code which leaves the application vulnerable to cross-site scripting (XSS). \nThis fix explicitly sets the response type to `application/json` when the response body is JSON data to avoid this vulnerability. Our changes look something like this:\n\n```diff\nfrom flask import make_response, Flask\nimport json\n\napp = Flask(__name__)\n\n@app.route(\"/test\")\ndef foo(request):\n    json_response = json.dumps({ \"user_input\": request.GET.get(\"input\") })\n-   return make_response(json_response)\n+   return make_response(json_response, {'Content-Type':'application/json'})\n```\n",
      "references": [
        {
          "url": "https://flask.palletsprojects.com/en/2.3.x/patterns/javascript/#return-json-from-views",
          "description": "https://flask.palletsprojects.com/en/2.3.x/patterns/javascript/#return-json-from-views"
        },
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html#output-encoding-for-javascript-contexts",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html#output-encoding-for-javascript-contexts"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/harden-pyyaml",
      "summary": "Replace unsafe `pyyaml` loader with `SafeLoader`",
      "description": "This codemod hardens all [`yaml.load()`](https://pyyaml.org/wiki/PyYAMLDocumentation) calls against attacks that could result from deserializing untrusted data.\n\nThe fix uses a safety check that already exists in the `yaml` module, replacing unsafe loader class with `SafeLoader`.\nThe changes from this codemod look like this:\n\n```diff\n  import yaml\n  data = b'!!python/object/apply:subprocess.Popen \\\\n- ls'\n- deserialized_data = yaml.load(data, yaml.Loader)\n+ deserialized_data = yaml.load(data, Loader=yaml.SafeLoader)\n```\nThe codemod will also catch if you pass in the loader argument as a kwarg and if you use any loader other than `SafeLoader`,\nincluding `FullLoader` and `UnsafeLoader`.\n",
      "references": [
        {
          "url": "https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data",
          "description": "https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/harden-ruamel",
      "summary": "Use `typ='safe'` in ruamel.yaml() Calls",
      "description": "This codemod hardens any unsafe [`ruamel.yaml.YAML()`](https://yaml.readthedocs.io/en/latest/) calls against attacks that could result from deserializing untrusted data.\n\nThe fix uses a safety check that already exists in the `ruamel` module, replacing an unsafe `typ` argument with `typ=\"safe\"`.\nThe changes from this codemod look like this:\n\n```diff\n  from ruamel.yaml import YAML\n- serializer = YAML(typ=\"unsafe\")\n- serializer = YAML(typ=\"base\")\n+ serializer = YAML(typ=\"safe\")\n+ serializer = YAML(typ=\"safe\")\n```\n",
      "references": [
        {
          "url": "https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data",
          "description": "https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/https-connection",
      "summary": "Enforce HTTPS Connection for `urllib3`",
      "description": "This codemod replaces calls to `urllib3.connectionpool.HTTPConnectionPool` and `urllib3.HTTPConnectionPool` with their secure variant (`HTTPSConnectionPool`).\n\nProgrammers should opt to use HTTPS over HTTP for secure encrypted communication whenever possible.\n\n```diff\nimport urllib3\n- urllib3.HTTPConnectionPool(\"www.example.com\",\"80\")\n+ urllib3.HTTPSConnectionPool(\"www.example.com\",\"80\")\n```\n",
      "references": [
        {
          "url": "https://owasp.org/www-community/vulnerabilities/Insecure_Transport",
          "description": "https://owasp.org/www-community/vulnerabilities/Insecure_Transport"
        },
        {
          "url": "https://urllib3.readthedocs.io/en/stable/reference/urllib3.connectionpool.html#urllib3.HTTPConnectionPool",
          "description": "https://urllib3.readthedocs.io/en/stable/reference/urllib3.connectionpool.html#urllib3.HTTPConnectionPool"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/jwt-decode-verify",
      "summary": "Verify JWT Decode",
      "description": "This codemod ensures calls to [jwt.decode](https://pyjwt.readthedocs.io/en/stable/api.html#jwt.decode) do not disable signature validation and other verifications. It checks that both the `verify` parameter (soon to be deprecated) and any `verify` key in the `options` dict parameter are not assigned to `False`.\n\nOur change looks as follows:\n\n```diff\n  import jwt\n  ...\n- decoded_payload = jwt.decode(encoded_jwt, SECRET_KEY, algorithms=[\"HS256\"], verify=False)\n+ decoded_payload = jwt.decode(encoded_jwt, SECRET_KEY, algorithms=[\"HS256\"], verify=True)\n  ...\n- decoded_payload = jwt.decode(encoded_jwt, SECRET_KEY, algorithms=[\"HS256\"], options={\"verify_signature\": False, \"verify_exp\": False})\n+ decoded_payload = jwt.decode(encoded_jwt, SECRET_KEY, algorithms=[\"HS256\"], options={\"verify_signature\": True, \"verify_exp\": True})\n```\n\nAny `verify` parameter not listed relies on the secure `True` default value.\n",
      "references": [
        {
          "url": "https://pyjwt.readthedocs.io/en/stable/api.html",
          "description": "https://pyjwt.readthedocs.io/en/stable/api.html"
        },
        {
          "url": "https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/06-Session_Management_Testing/10-Testing_JSON_Web_Tokens",
          "description": "https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/06-Session_Management_Testing/10-Testing_JSON_Web_Tokens"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/lazy-logging",
      "summary": "Convert Eager Logging to Lazy Logging",
      "description": "This codemod converts \"eager\" logging into \"lazy\" logging, which is preferred for performance efficiency and resource optimization.\nLazy logging defers the actual construction and formatting of log messages until it's confirmed that the message will be logged based on the current log level, thereby avoiding unnecessary computation for messages that will not be logged. \n\nOur changes look something like this:\n\n```diff\nimport logging\ne = \"Some error\"\n- logging.error(\"Error occurred: %s\" % e)\n- logging.error(\"Error occurred: \" + e)\n+ logging.error(\"Error occurred: %s\", e)\n+ logging.error(\"Error occurred: %s\", e)\n```\n",
      "references": [],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/limit-readline",
      "summary": "Limit readline()",
      "description": "This codemod hardens all [`readline()`](https://docs.python.org/3/library/io.html#io.IOBase.readline) calls from file objects returned from an `open()` call, `StringIO` and `BytesIO` against denial of service attacks. A stream influenced by an attacker could keep providing bytes until the system runs out of memory, causing a crash.\n\nFixing it is straightforward by providing adding a size argument to any `readline()` calls.\nThe changes from this codemod look like this:\n\n```diff\n  file = open('some_file.txt')\n- file.readline()\n+ file.readline(5_000_000)\n```\n",
      "references": [
        {
          "url": "https://cwe.mitre.org/data/definitions/400.html",
          "description": "https://cwe.mitre.org/data/definitions/400.html"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": [
        {
          "path": "tensorflow/lite/tools/evaluation/tasks/coco_object_detection/preprocess_coco_minival.py",
          "diff": "--- \n+++ \n@@ -63,7 +63,7 @@\n   \"\"\"\n   # Read JSON data into a dict.\n   with open(instances_file, 'r') as annotation_dump:\n-    data_dict = ast.literal_eval(annotation_dump.readline())\n+    data_dict = ast.literal_eval(annotation_dump.readline(5_000_000))\n \n   image_data = collections.OrderedDict()\n \n",
          "changes": [
            {
              "lineNumber": "66",
              "description": "Adds a size limit argument to readline() calls.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:python/literal-or-new-object-identity",
      "summary": "Replace `is` with `==` for literal or new object comparisons",
      "description": "The `is` and `is not` operators only evaluate to `True` when the expressions on each side have the same `id`. In other words, `a is b` is equivalent to `id(a) == id(b)`. With few exceptions, objects and literals have unique identities and thus shouldn't generally be compared by using the `is` or `is not` operators.\n\nOur changes look something like this:\n\n```diff\ndef foo(l):\n-    return l is [1,2,3]\n+    return l == [1,2,3]\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/stdtypes.html#comparisons",
          "description": "https://docs.python.org/3/library/stdtypes.html#comparisons"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/numpy-nan-equality",
      "summary": "Replace == comparison with numpy.isnan()",
      "description": "Comparisons against `numpy.nan` always result in `False`. Thus comparing an expression directly against `numpy.nan` is always unintended. The correct way to compare a value for `NaN` is to use the `numpy.isnan` function.\n\nOur changes look something like this:\n\n```diff\nimport numpy as np\n\na = np.nan\n-if a == np.nan:\n+if np.isnan(a):\n    pass\n```\n",
      "references": [
        {
          "url": "https://numpy.org/doc/stable/reference/constants.html#numpy.nan",
          "description": "https://numpy.org/doc/stable/reference/constants.html#numpy.nan"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/remove-assertion-in-pytest-raises",
      "summary": "Moves assertions out of `pytest.raises` scope",
      "description": "The context manager object `pytest.raises(<exception>)` will assert if the code contained within its scope will raise an exception of type `<exception>`. The documentation points that the exception must be raised in the last line of its scope and any line afterwards won't be executed. \nIncluding asserts at the end of the scope is a common error. This codemod addresses that by moving them out of the scope.\nOur changes look something like this:\n\n```diff\nimport pytest\n\ndef test_foo():\n    with pytest.raises(ZeroDivisionError):\n        error = 1/0\n-       assert 1\n-       assert 2\n+   assert 1\n+   assert 2\n```\n",
      "references": [
        {
          "url": "https://docs.pytest.org/en/7.4.x/reference/reference.html#pytest-raises",
          "description": "https://docs.pytest.org/en/7.4.x/reference/reference.html#pytest-raises"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/remove-debug-breakpoint",
      "summary": "Remove Calls to `builtin` `breakpoint` and `pdb.set_trace",
      "description": "This codemod removes any calls to `breakpoint()` or `pdb.set_trace()` which are generally only used for interactive debugging and should not be deployed in production code.\n\nIn most cases if these calls are included in committed code, they were left there by mistake and indicate a potential problem.\n\n```diff\n print(\"hello\")\n- breakpoint()\n print(\"world\")\n```\n",
      "references": [],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/remove-future-imports",
      "summary": "Remove deprecated `__future__` imports",
      "description": "Many older codebases have `__future__` imports for forwards compatibility with features. As of this writing, all but one of those features is now stable in all currently supported versions of Python and so the imports are no longer needed. While such imports are harmless, they are also unnecessary and in most cases you probably just forgot to remove them. \n\nThis codemod removes all such `__future__` imports, preserving only those that are still necessary for forwards compatibility. \n\nOur changes look like the following:\n```diff\n import os\n-from __future__ import print_function\n\n print(\"HELLO\")\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/__future__.html",
          "description": "https://docs.python.org/3/library/__future__.html"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/remove-module-global",
      "summary": "Remove `global` Usage at Module Level",
      "description": "Using the `global` keyword is necessary only when you intend to modify a module-level (aka global) variable within a non-global scope, such as within a class or function. It is unnecessary to call `global` at the module-level.\n\nOur changes look something like this:\n\n```diff\n price = 25\n print(\"hello\")\n- global price\n price = 30\n```\n",
      "references": [],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/remove-unnecessary-f-str",
      "summary": "Remove Unnecessary F-strings",
      "description": "This codemod converts any f-strings without interpolated variables into regular strings.\nIn these cases the use of f-string is not necessary; a simple string literal is sufficient. \n\nWhile in some (extreme) cases we might expect a very modest performance\nimprovement, in general this is a fix that improves the overall cleanliness and\nquality of your code.\n\n```diff\n- var = f\"hello\"\n+ var = \"hello\"\n  ...\n```\n",
      "references": [
        {
          "url": "https://pylint.readthedocs.io/en/latest/user_guide/messages/warning/f-string-without-interpolation.html",
          "description": "https://pylint.readthedocs.io/en/latest/user_guide/messages/warning/f-string-without-interpolation.html"
        },
        {
          "url": "https://github.com/Instagram/LibCST/blob/main/libcst/codemod/commands/unnecessary_format_string.py",
          "description": "https://github.com/Instagram/LibCST/blob/main/libcst/codemod/commands/unnecessary_format_string.py"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/replace-flask-send-file",
      "summary": "Replace unsafe usage of `flask.send_file`",
      "description": "The `Flask` `send_file` function from Flask is susceptible to a path traversal attack if its input is not properly validated.\nIn a path traversal attack, the malicious agent can craft a path containing special paths like `./` or `../` to resolve a file outside of the expected directory path. This potentially allows the agent to overwrite, delete or read arbitrary files. In the case of `flask.send_file`, the result is that a malicious user could potentially download sensitive files that exist on the filesystem where the application is being hosted.\nFlask offers a native solution with the `flask.send_from_directory` function that validates the given path.\n\nOur changes look something like this:\n\n```diff\n-from flask import Flask, send_file\n+from flask import Flask\n+import flask\n+from pathlib import Path\n\napp = Flask(__name__)\n\n@app.route(\"/uploads/<path:name>\")\ndef download_file(name):\n-    return send_file(f'path/to/{name}.txt')\n+    return flask.send_from_directory((p := Path(f'path/to/{name}.txt')).parent, p.name)\n```\n",
      "references": [
        {
          "url": "https://flask.palletsprojects.com/en/3.0.x/api/#flask.send_from_directory",
          "description": "https://flask.palletsprojects.com/en/3.0.x/api/#flask.send_from_directory"
        },
        {
          "url": "https://owasp.org/www-community/attacks/Path_Traversal",
          "description": "https://owasp.org/www-community/attacks/Path_Traversal"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/requests-verify",
      "summary": "Verify SSL Certificates for Requests.",
      "description": "This codemod checks that calls to the `requests` module API or the `httpx` library use `verify=True` or a path to a CA bundle to ensure TLS certificate validation.\n\nThe [requests documentation](https://requests.readthedocs.io/en/latest/api/) warns that the `verify` flag\n> When set to False, requests will accept any TLS certificate presented by the server, and will ignore hostname mismatches and/or expired certificates, which will make your application vulnerable to man-in-the-middle (MitM) attacks. Setting verify to False may be useful during local development or testing.\n\nSimilarly, setting `verify=False` when using the `httpx` library to make requests disables certificate verification.\n\nThe changes from this codemod look like this:\n\n\n```diff\n  import requests\n  \n- requests.get(\"www.google.com\", ...,verify=False)\n+ requests.get(\"www.google.com\", ...,verify=True)\n...\nimport httpx\n  \n- httpx.get(\"www.google.com\", ...,verify=False)\n+ httpx.get(\"www.google.com\", ...,verify=True)\n\n```\n\nThis codemod also checks other methods in the `requests` module and `httpx` library that accept a `verify` flag (e.g. `requests.post`, `httpx.AsyncClient`, etc.)\n",
      "references": [
        {
          "url": "https://requests.readthedocs.io/en/latest/api/",
          "description": "https://requests.readthedocs.io/en/latest/api/"
        },
        {
          "url": "https://www.python-httpx.org/",
          "description": "https://www.python-httpx.org/"
        },
        {
          "url": "https://owasp.org/www-community/attacks/Manipulator-in-the-middle_attack",
          "description": "https://owasp.org/www-community/attacks/Manipulator-in-the-middle_attack"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/safe-lxml-parser-defaults",
      "summary": "Use Safe Defaults for `lxml` Parsers",
      "description": "This codemod configures safe parameter values when initializing `lxml.etree.XMLParser`, `lxml.etree.ETCompatXMLParser`, `lxml.etree.XMLTreeBuilder`, or `lxml.etree.XMLPullParser`. If parameters `resolve_entities`, `no_network`, and `dtd_validation` are not set to safe values, your code may be vulnerable to entity expansion attacks and external entity (XXE) attacks.\n\nParameters `no_network` and `dtd_validation` have safe default values of `True` and `False`, respectively, so this codemod will set each to the default safe value if your code has assigned either to an unsafe value.\n\nParameter `resolve_entities` has an unsafe default value of `True`. This codemod will set `resolve_entities=False` if set to `True` or omitted.\n\nThe changes look as follows:\n\n```diff\n  import lxml.etree\n\n- parser = lxml.etree.XMLParser()\n- parser = lxml.etree.XMLParser(resolve_entities=True)\n- parser = lxml.etree.XMLParser(resolve_entities=True, no_network=False, dtd_validation=True)\n+ parser = lxml.etree.XMLParser(resolve_entities=False)\n+ parser = lxml.etree.XMLParser(resolve_entities=False)\n+ parser = lxml.etree.XMLParser(resolve_entities=False, no_network=True, dtd_validation=False)\n```\n",
      "references": [
        {
          "url": "https://lxml.de/apidoc/lxml.etree.html#lxml.etree.XMLParser",
          "description": "https://lxml.de/apidoc/lxml.etree.html#lxml.etree.XMLParser"
        },
        {
          "url": "https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing",
          "description": "https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing"
        },
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/safe-lxml-parsing",
      "summary": "Use Safe Parsers in `lxml` Parsing Functions",
      "description": "This codemod sets the `parser` parameter in calls to  `lxml.etree.parse`  and `lxml.etree.fromstring` if omitted or set to `None` (the default value). Unfortunately, the default `parser=None` means `lxml` will rely on an unsafe parser, making your code potentially vulnerable to entity expansion attacks and external entity (XXE) attacks.\n\nThe changes look as follows:\n\n```diff\n  import lxml.etree\n- lxml.etree.parse(\"path_to_file\")\n- lxml.etree.fromstring(\"xml_str\")\n+ lxml.etree.parse(\"path_to_file\", parser=lxml.etree.XMLParser(resolve_entities=False))\n+ lxml.etree.fromstring(\"xml_str\", parser=lxml.etree.XMLParser(resolve_entities=False))\n```\n",
      "references": [
        {
          "url": "https://lxml.de/apidoc/lxml.etree.html#lxml.etree.XMLParser",
          "description": "https://lxml.de/apidoc/lxml.etree.html#lxml.etree.XMLParser"
        },
        {
          "url": "https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing",
          "description": "https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing"
        },
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/sandbox-process-creation",
      "summary": "Sandbox Process Creation",
      "description": "This codemod sandboxes all instances of [subprocess.run](https://docs.python.org/3/library/subprocess.html#subprocess.run) and [subprocess.call](https://docs.python.org/3/library/subprocess.html#subprocess.call) to offer protection against attack.\n\nLeft unchecked, `subprocess.run` and `subprocess.call` can execute any arbitrary system command. If an attacker can control part of the strings used as program paths or arguments, they could execute arbitrary programs, install malware, and anything else they could do if they had a shell open on the application host.\n\nOur change introduces a sandbox which protects the application:\n\n```diff\n  import subprocess\n+ from security import safe_command\n  ...\n- subprocess.run(\"echo 'hi'\", shell=True)\n+ safe_command.run(subprocess.run, \"echo 'hi'\", shell=True)\n  ...\n- subprocess.call([\"ls\", \"-l\"])\n+ safe_command.call(subprocess.call, [\"ls\", \"-l\"])\n```\n\nThe default `safe_command` restrictions applied are the following:\n* **Prevent command chaining**. Many exploits work by injecting command separators and causing the shell to interpret a second, malicious command. The `safe_command` functions attempt to parse the given command, and throw a `SecurityException` if multiple commands are present.\n* **Prevent arguments targeting sensitive files.** There is little reason for custom code to target sensitive system files like `/etc/passwd`, so the sandbox prevents arguments that point to these files that may be targets for exfiltration.\n\nThere are [more options for sandboxing](https://github.com/pixee/python-security/blob/main/src/security/safe_command/api.py#L5) if you are interested in locking down system commands even more.\n\n## Dependency Updates\n\nThis codemod relies on an external dependency. However, we were unable to automatically add the dependency to your project. \n\nThis library holds security tools for protecting Python API calls. \n\nThere are a number of places where Python project dependencies can be expressed, including `setup.py`, `pyproject.toml`, `setup.cfg`, and `requirements.txt` files. You may need to manually add this dependency to the proper location in your project.\n\n### Manual Installation\n\nFor `setup.py`:\n```diff\n install_requires=[\n+    \"security~=1.2.0\",\n ],\n```\n\nFor `pyproject.toml` (using `setuptools`):\n```diff\n [project]\n dependencies = [\n+    \"security~=1.2.0\",\n ]\n```\n\nFor `setup.cfg`:\n```diff\n [options]\n install_requires =\n+    security~=1.2.0\n```\n\nFor `requirements.txt`:\n```diff\n+security~=1.2.0\n```\n\nFor more information on adding dependencies to `setuptools` projects, see [the setuptools documentation](https://setuptools.pypa.io/en/latest/userguide/dependency_management.html#declaring-required-dependency). \n\nIf you are using another build system, please refer to the documentation for that system to determine how to add dependencies.\n",
      "references": [
        {
          "url": "https://github.com/pixee/python-security/blob/main/src/security/safe_command/api.py",
          "description": "https://github.com/pixee/python-security/blob/main/src/security/safe_command/api.py"
        },
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": [
        {
          "path": "configure.py",
          "diff": "--- \n+++ \n@@ -23,6 +23,7 @@\n import re\n import subprocess\n import sys\n+from security import safe_command\n \n # pylint: disable=g-import-not-at-top\n try:\n@@ -1197,8 +1198,7 @@\n   if not paths:\n     raise FileNotFoundError(\n         \"Can't find 'find_cuda_config.py' script inside working directory\")\n-  proc = subprocess.Popen(\n-      [environ_cp['PYTHON_BIN_PATH'], paths[0]] + cuda_libraries,\n+  proc = safe_command.run(subprocess.Popen, [environ_cp['PYTHON_BIN_PATH'], paths[0]] + cuda_libraries,\n       stdout=subprocess.PIPE,\n       env=maybe_encode_env(environ_cp))\n \n",
          "changes": [
            {
              "lineNumber": "1200",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/lite/python/convert.py",
          "diff": "--- \n+++ \n@@ -44,6 +44,7 @@\n from tensorflow.python.platform import resource_loader as _resource_loader\n from tensorflow.python.util import deprecation\n from tensorflow.python.util.tf_export import tf_export as _tf_export\n+from security import safe_command\n \n \n def _is_quantized_input_stats_required(\n@@ -467,8 +468,7 @@\n     ]\n     cmdline = \" \".join(cmd)\n     is_windows = _platform.system() == \"Windows\"\n-    proc = _subprocess.Popen(\n-        cmdline,\n+    proc = safe_command.run(_subprocess.Popen, cmdline,\n         shell=True,\n         stdout=_subprocess.PIPE,\n         stderr=_subprocess.STDOUT,\n",
          "changes": [
            {
              "lineNumber": "470",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/lite/schema/upgrade_schema.py",
          "diff": "--- \n+++ \n@@ -33,6 +33,7 @@\n \n import tensorflow as tf\n from tensorflow.python.platform import resource_loader\n+from security import safe_command\n \n parser = argparse.ArgumentParser(\n     description=\"Script to move TFLite models from pre-release schema to \"\n@@ -127,7 +128,7 @@\n       basename_no_extension, extension = os.path.splitext(basename)\n       if extension in [\".bin\", \".tflite\"]:\n         # Convert to json using flatc\n-        returncode = subprocess.call([\n+        returncode = safe_command.run(subprocess.call, [\n             self._flatc_path,\n             \"-t\",\n             \"--strict-json\",\n@@ -163,7 +164,7 @@\n         input_json = os.path.join(tempdir, \"temp.json\")\n         with open(input_json, \"w\") as fp:\n           json.dump(data, fp, sort_keys=True, indent=2)\n-        returncode = subprocess.call([\n+        returncode = safe_command.run(subprocess.call, [\n             self._flatc_path, \"-b\", \"--defaults-json\", \"--strict-json\", \"-o\",\n             tempdir, self._new_schema, input_json\n         ])\n",
          "changes": [
            {
              "lineNumber": "130",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "166",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/lite/tools/flatbuffer_utils_test.py",
          "diff": "--- \n+++ \n@@ -22,6 +22,7 @@\n from tensorflow.lite.tools import test_utils\n from tensorflow.python.framework import test_util\n from tensorflow.python.platform import test\n+from security import safe_command\n \n _SKIPPED_BUFFER_INDEX = 1\n \n@@ -222,7 +223,7 @@\n     input_cc_file = os.path.join(tmp_dir, 'model.cc')\n \n     command = 'xxd -i {} > {}'.format(model_filename, input_cc_file)\n-    subprocess.call(command, shell=True)\n+    safe_command.run(subprocess.call, command, shell=True)\n \n     # 4. VALIDATE\n     final_bytes = flatbuffer_utils.xxd_output_to_bytes(input_cc_file)\n",
          "changes": [
            {
              "lineNumber": "225",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/distribute/multi_worker_test_base.py",
          "diff": "--- \n+++ \n@@ -47,6 +47,7 @@\n from tensorflow.python.util import nest\n from tensorflow.python.util.compat import collections_abc\n from tensorflow.python.util.tf_export import tf_export\n+from security import safe_command\n \n \n original_run_std_server = dc._run_std_server  # pylint: disable=protected-access\n@@ -740,8 +741,7 @@\n             'index': task_id\n         }\n     })\n-    return subprocess.Popen(\n-        cmd_args, stdout=subprocess.PIPE, stderr=subprocess.PIPE, env=env)\n+    return safe_command.run(subprocess.Popen, cmd_args, stdout=subprocess.PIPE, stderr=subprocess.PIPE, env=env)\n \n   @deprecation.deprecated(\n       None, '`run_multiple_tasks_in_processes` is deprecated; any new test '\n",
          "changes": [
            {
              "lineNumber": "743",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/platform/stacktrace_handler_test.py",
          "diff": "--- \n+++ \n@@ -22,6 +22,7 @@\n \n from tensorflow.python.platform import test\n from tensorflow.python.platform import tf_logging as logging\n+from security import safe_command\n \n \n # FLAGS defined at the bottom:\n@@ -43,12 +44,10 @@\n \n     # Subprocess sys.argv[0] with --child=True\n     if sys.executable:\n-      child_process = subprocess.Popen(\n-          [sys.executable, sys.argv[0], '--child=True'], cwd=os.getcwd(),\n+      child_process = safe_command.run(subprocess.Popen, [sys.executable, sys.argv[0], '--child=True'], cwd=os.getcwd(),\n           stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n     else:\n-      child_process = subprocess.Popen(\n-          [sys.argv[0], '--child=True'], cwd=os.getcwd(),\n+      child_process = safe_command.run(subprocess.Popen, [sys.argv[0], '--child=True'], cwd=os.getcwd(),\n           stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n \n     # Capture its output. capture both stdout and stderr and append them.\n",
          "changes": [
            {
              "lineNumber": "46",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "50",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/tools/grpc_tpu_worker_service.py",
          "diff": "--- \n+++ \n@@ -22,6 +22,7 @@\n import os\n import subprocess\n import sys\n+from security import safe_command\n \n \n def get_sys_path():\n@@ -65,10 +66,10 @@\n def move_file_to_systemd(service_name):\n   if not os.path.exists(\"~/.config/systemd/user/\"):\n     mkdir_command = \"mkdir -p ~/.config/systemd/user\"\n-    subprocess.run(mkdir_command, shell=True, check=True)\n+    safe_command.run(subprocess.run, mkdir_command, shell=True, check=True)\n     print(\"Created directory ~/.config/systemd/user/\")\n   command = f\"mv {service_name} ~/.config/systemd/user/{service_name}\"\n-  subprocess.run(command, shell=True, check=True)\n+  safe_command.run(subprocess.run, command, shell=True, check=True)\n   print(f\"Service file moved to ~/.config/systemd/user/{service_name}\")\n \n \n@@ -80,7 +81,7 @@\n       f\"systemctl --user start {service_name}\",\n   ]\n   for command in commands:\n-    subprocess.run(command, shell=True, check=True)\n+    safe_command.run(subprocess.run, command, shell=True, check=True)\n     print(f\"Executed: {command}\")\n \n \n",
          "changes": [
            {
              "lineNumber": "68",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "71",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "83",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/tools/docs/build_cc_api_headers.py",
          "diff": "--- \n+++ \n@@ -19,6 +19,7 @@\n \n from absl import app\n from absl import flags\n+from security import safe_command\n \n FLAGS = flags.FLAGS\n \n@@ -37,8 +38,8 @@\n   os.makedirs(output_dir, exist_ok=True)\n \n   # `$ yes | configure`\n-  yes = subprocess.Popen(['yes', ''], stdout=subprocess.PIPE)\n-  configure = subprocess.Popen([TENSORFLOW_ROOT / 'configure'],\n+  yes = safe_command.run(subprocess.Popen, ['yes', ''], stdout=subprocess.PIPE)\n+  configure = safe_command.run(subprocess.Popen, [TENSORFLOW_ROOT / 'configure'],\n                                stdin=yes.stdout,\n                                cwd=TENSORFLOW_ROOT)\n   configure.communicate()\n",
          "changes": [
            {
              "lineNumber": "40",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "41",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/tools/docs/build_java_api_docs.py",
          "diff": "--- \n+++ \n@@ -22,6 +22,7 @@\n from absl import flags\n \n from tensorflow_docs.api_generator import gen_java\n+from security import safe_command\n \n FLAGS = flags.FLAGS\n \n@@ -58,8 +59,8 @@\n \n   if FLAGS.gen_ops:\n     # `$ yes | configure`\n-    yes = subprocess.Popen(['yes', ''], stdout=subprocess.PIPE)\n-    configure = subprocess.Popen([TENSORFLOW_ROOT / 'configure'],\n+    yes = safe_command.run(subprocess.Popen, ['yes', ''], stdout=subprocess.PIPE)\n+    configure = safe_command.run(subprocess.Popen, [TENSORFLOW_ROOT / 'configure'],\n                                  stdin=yes.stdout,\n                                  cwd=TENSORFLOW_ROOT)\n     configure.communicate()\n",
          "changes": [
            {
              "lineNumber": "61",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "62",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/tools/pip_package/build_pip_package.py",
          "diff": "--- \n+++ \n@@ -37,6 +37,7 @@\n from tensorflow.tools.pip_package.utils.utils import is_macos\n from tensorflow.tools.pip_package.utils.utils import is_windows\n from tensorflow.tools.pip_package.utils.utils import replace_inplace\n+from security import safe_command\n \n \n def parse_args() -> argparse.Namespace:\n@@ -240,9 +241,9 @@\n         [\"patchelf\", \"--print-rpath\",\n          \"{}/{}\".format(srcs_dir, file)]).decode().strip()\n     new_rpath = rpath + \":\" + path\n-    subprocess.run([\"patchelf\", \"--set-rpath\", new_rpath,\n+    safe_command.run(subprocess.run, [\"patchelf\", \"--set-rpath\", new_rpath,\n                     \"{}/{}\".format(srcs_dir, file)], check=True)\n-    subprocess.run([\"patchelf\", \"--shrink-rpath\",\n+    safe_command.run(subprocess.run, [\"patchelf\", \"--shrink-rpath\",\n                     \"{}/{}\".format(srcs_dir, file)], check=True)\n \n \n@@ -319,8 +320,7 @@\n   if collab == \"True\":\n     env[\"collaborator_build\"] = True\n \n-  subprocess.run(\n-      [\n+  safe_command.run(subprocess.run, [\n           sys.executable,\n           \"tensorflow/tools/pip_package/setup.py\",\n           \"bdist_wheel\",\n",
          "changes": [
            {
              "lineNumber": "243",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "245",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "322",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/tools/tensorflow_builder/config_detector/config_detector.py",
          "diff": "--- \n+++ \n@@ -69,6 +69,7 @@\n from absl import flags\n \n from tensorflow.tools.tensorflow_builder.config_detector.data import cuda_compute_capability\n+from security import safe_command\n \n FLAGS = flags.FLAGS\n # Define all flags\n@@ -135,8 +136,7 @@\n   Returns:\n     Tuple output (stdoutdata, stderrdata) from running the shell commands.\n   \"\"\"\n-  proc = subprocess.Popen(\n-      args,\n+  proc = safe_command.run(subprocess.Popen, args,\n       shell=True,\n       stdout=subprocess.PIPE,\n       stderr=subprocess.STDOUT\n",
          "changes": [
            {
              "lineNumber": "138",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "third_party/xla/build_tools/configure/configure.py",
          "diff": "--- \n+++ \n@@ -44,6 +44,7 @@\n import subprocess\n import sys\n from typing import Optional\n+from security import safe_command\n \n _REQUIRED_CUDA_LIBRARIES = [\"cublas\", \"cuda\", \"cudnn\"]\n _DEFAULT_BUILD_AND_TEST_TAG_FILTERS = (\"-no_oss\",)\n@@ -105,8 +106,7 @@\n   \"\"\"\n   try:\n     nvidia_smi = _find_executable_or_die(\"nvidia-smi\")\n-    nvidia_smi_proc = subprocess.run(\n-        [nvidia_smi, \"--query-gpu=compute_cap\", \"--format=csv,noheader\"],\n+    nvidia_smi_proc = safe_command.run(subprocess.run, [nvidia_smi, \"--query-gpu=compute_cap\", \"--format=csv,noheader\"],\n         capture_output=True,\n         check=True,\n         text=True,\n@@ -134,8 +134,7 @@\n     The major version.\n   \"\"\"\n   logging.info(\"Running echo __clang_major__ | %s -E -P -\", path_to_clang)\n-  clang_version_proc = subprocess.run(\n-      [path_to_clang, \"-E\", \"-P\", \"-\"],\n+  clang_version_proc = safe_command.run(subprocess.run, [path_to_clang, \"-E\", \"-P\", \"-\"],\n       input=\"__clang_major__\",\n       check=True,\n       capture_output=True,\n@@ -284,8 +283,7 @@\n           \"so trying to find them using find_cuda_config.py\"\n       )\n       try:\n-        find_cuda_config_proc = subprocess.run(\n-            [\n+        find_cuda_config_proc = safe_command.run(subprocess.run, [\n                 sys.executable,\n                 _FIND_CUDA_CONFIG,\n                 *_REQUIRED_CUDA_LIBRARIES,\n",
          "changes": [
            {
              "lineNumber": "108",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "137",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "287",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "third_party/xla/build_tools/lint/diff_parser.py",
          "diff": "--- \n+++ \n@@ -17,6 +17,7 @@\n import re\n import subprocess\n from typing import Generator, Iterable, TypeVar\n+from security import safe_command\n \n _T = TypeVar(\"_T\")\n \n@@ -107,8 +108,7 @@\n \n def get_git_diff_stdout() -> str:\n   \"\"\"Run git diff with appropriate arguments and capture stdout as a str.\"\"\"\n-  proc = subprocess.run(\n-      [\"git\", \"diff\", \"origin/main\", \"HEAD\"],\n+  proc = safe_command.run(subprocess.run, [\"git\", \"diff\", \"origin/main\", \"HEAD\"],\n       capture_output=True,\n       check=True,\n       text=True,\n",
          "changes": [
            {
              "lineNumber": "110",
              "description": "Replaces subprocess.{func} with more secure safe_command library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:python/secure-flask-cookie",
      "summary": "Use Safe Parameters in `flask` Response `set_cookie` Call",
      "description": "This codemod sets the most secure parameters when Flask applications call `set_cookie` on a response object. Without these parameters, your Flask\napplication cookies may be vulnerable to being intercepted and used to gain access to sensitive data.\n\nThe changes from this codemod look like this:\n\n```diff\n  from flask import Flask, session, make_response\n  app = Flask(__name__)\n  @app.route('/')\n    def index():\n      resp = make_response('Custom Cookie Set')\n    - resp.set_cookie('custom_cookie', 'value')\n    + resp.set_cookie('custom_cookie', 'value', secure=True, httponly=True, samesite='Lax')\n      return resp\n```\n",
      "references": [
        {
          "url": "https://flask.palletsprojects.com/en/3.0.x/api/#flask.Response.set_cookie",
          "description": "https://flask.palletsprojects.com/en/3.0.x/api/#flask.Response.set_cookie"
        },
        {
          "url": "https://owasp.org/www-community/controls/SecureCookieAttribute",
          "description": "https://owasp.org/www-community/controls/SecureCookieAttribute"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/secure-flask-session-configuration",
      "summary": "Flip Insecure `Flask` Session Configurations",
      "description": "Flask applications can configure sessions behavior at the application level. \nThis codemod looks for Flask application configuration that set `SESSION_COOKIE_HTTPONLY`, `SESSION_COOKIE_SECURE`, or `SESSION_COOKIE_SAMESITE` to an insecure value and changes it to a secure one.\n\nThe changes from this codemod look like this:\n\n```diff\n  from flask import Flask\n  app = Flask(__name__)\n- app.config['SESSION_COOKIE_HTTPONLY'] = False\n- app.config.update(SESSION_COOKIE_SECURE=False)\n+ app.config['SESSION_COOKIE_HTTPONLY'] = True\n+ app.config.update(SESSION_COOKIE_SECURE=True)\n```\n",
      "references": [
        {
          "url": "https://owasp.org/www-community/controls/SecureCookieAttribute",
          "description": "https://owasp.org/www-community/controls/SecureCookieAttribute"
        },
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/secure-random",
      "summary": "Secure Source of Randomness",
      "description": "This codemod replaces all instances of functions in the `random` module (e.g. `random.random()` with their, much more secure, equivalents from the `secrets` module (e.g. `secrets.SystemRandom().random()`).\n\nThere is significant algorithmic complexity in getting computers to generate genuinely unguessable random bits. The `random.random()` function uses a method of pseudo-random number generation that unfortunately emits fairly predictable numbers.\n\nIf the numbers it emits are predictable, then it's obviously not safe to use in cryptographic operations, file name creation, token construction, password generation, and anything else that's related to security. In fact, it may affect security even if it's not directly obvious.\n\nSwitching to a more secure version is simple and the changes look something like this:\n\n```diff\n- import random\n+ import secrets\n  ...\n- random.random()\n+ secrets.SystemRandom().random()\n```\n",
      "references": [
        {
          "url": "https://owasp.org/www-community/vulnerabilities/Insecure_Randomness",
          "description": "https://owasp.org/www-community/vulnerabilities/Insecure_Randomness"
        },
        {
          "url": "https://docs.python.org/3/library/random.html",
          "description": "https://docs.python.org/3/library/random.html"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": [
        {
          "path": "tensorflow/compiler/mlir/quantization/tensorflow/python/representative_dataset_test.py",
          "diff": "--- \n+++ \n@@ -13,7 +13,6 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Tests for representative_dataset.py.\"\"\"\n-import random\n \n import numpy as np\n \n@@ -25,6 +24,7 @@\n from tensorflow.python.framework import test_util\n from tensorflow.python.platform import test\n from tensorflow.python.types import core\n+import secrets\n \n \n def _contains_tensor(sample: repr_dataset.RepresentativeSample) -> bool:\n@@ -184,7 +184,7 @@\n         for _ in range(4)\n     ])\n \n-    random.shuffle(repr_ds)\n+    secrets.SystemRandom().shuffle(repr_ds)\n \n     with self.session() as sess:\n       new_repr_ds = repr_dataset.replace_tensors_by_numpy_ndarrays(\n",
          "changes": [
            {
              "lineNumber": "187",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/compiler/tests/xla_test.py",
          "diff": "--- \n+++ \n@@ -17,7 +17,6 @@\n from collections.abc import Iterator\n import contextlib\n import os\n-import random\n import re\n \n import numpy as np\n@@ -37,6 +36,7 @@\n from tensorflow.python.platform import flags\n from tensorflow.python.platform import test\n from tensorflow.python.platform import tf_logging as logging\n+import secrets\n \n FLAGS = flags.FLAGS\n \n@@ -230,7 +230,7 @@\n       return\n     logging.info('Start test case: %s', name)\n \n-    random.seed(random_seed.DEFAULT_GRAPH_SEED)\n+    secrets.SystemRandom().seed(random_seed.DEFAULT_GRAPH_SEED)\n     np.random.seed(random_seed.DEFAULT_GRAPH_SEED)\n \n   def tearDown(self):\n",
          "changes": [
            {
              "lineNumber": "233",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/examples/speech_commands/input_data.py",
          "diff": "--- \n+++ \n@@ -18,7 +18,6 @@\n import hashlib\n import math\n import os.path\n-import random\n import re\n import sys\n import tarfile\n@@ -31,6 +30,7 @@\n from tensorflow.python.ops import io_ops\n from tensorflow.python.platform import gfile\n from tensorflow.python.util import compat\n+import secrets\n \n tf.compat.v1.disable_eager_execution()\n \n@@ -266,7 +266,7 @@\n       Exception: If expected files are not found.\n     \"\"\"\n     # Make sure the shuffling and picking of unknowns is deterministic.\n-    random.seed(RANDOM_SEED)\n+    secrets.SystemRandom().seed(RANDOM_SEED)\n     wanted_words_index = {}\n     for index, wanted_word in enumerate(wanted_words):\n       wanted_words_index[wanted_word] = index + 2\n@@ -309,12 +309,12 @@\n             'file': silence_wav_path\n         })\n       # Pick some unknowns to add to each partition of the data set.\n-      random.shuffle(unknown_index[set_index])\n+      secrets.SystemRandom().shuffle(unknown_index[set_index])\n       unknown_size = int(math.ceil(set_size * unknown_percentage / 100))\n       self.data_index[set_index].extend(unknown_index[set_index][:unknown_size])\n     # Make sure the ordering is random.\n     for set_index in ['validation', 'testing', 'training']:\n-      random.shuffle(self.data_index[set_index])\n+      secrets.SystemRandom().shuffle(self.data_index[set_index])\n     # Prepare the rest of the result data structure.\n     self.words_list = prepare_words_list(wanted_words)\n     self.word_to_index = {}\n",
          "changes": [
            {
              "lineNumber": "269",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "312",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "317",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/lite/testing/op_tests/arg_min_max.py",
          "diff": "--- \n+++ \n@@ -13,12 +13,12 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Test configs for arg_min_max.\"\"\"\n-import random\n \n import tensorflow as tf\n from tensorflow.lite.testing.zip_test_utils import create_tensor_data\n from tensorflow.lite.testing.zip_test_utils import make_zip_of_tests\n from tensorflow.lite.testing.zip_test_utils import register_make_test_function\n+import secrets\n \n \n @register_make_test_function()\n@@ -60,7 +60,7 @@\n         name=\"input\",\n         shape=parameters[\"input_shape\"])\n     if not parameters[\"is_last_axis\"]:\n-      axis = random.randint(0, max(len(parameters[\"input_shape\"]) - 1, 0))\n+      axis = secrets.SystemRandom().randint(0, max(len(parameters[\"input_shape\"]) - 1, 0))\n     else:\n       axis = -1\n     if parameters[\"is_arg_max\"]:\n",
          "changes": [
            {
              "lineNumber": "63",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/lite/tools/flatbuffer_utils.py",
          "diff": "--- \n+++ \n@@ -21,7 +21,6 @@\n \"\"\"\n \n import copy\n-import random\n import re\n import struct\n import sys\n@@ -31,6 +30,7 @@\n from tensorflow.lite.python import schema_py_generated as schema_fb\n from tensorflow.lite.python import schema_util\n from tensorflow.python.platform import gfile\n+import secrets\n \n _TFLITE_FILE_IDENTIFIER = b'TFL3'\n \n@@ -160,7 +160,7 @@\n   \"\"\"\n \n   # The input to the random seed generator. The default value is 0.\n-  random.seed(random_seed)\n+  secrets.SystemRandom().seed(random_seed)\n \n   # Parse model buffers which store the model weights\n   buffers = model.buffers\n@@ -193,11 +193,11 @@\n     if buffer_type.startswith('FLOAT'):\n       format_code = 'e' if buffer_type == 'FLOAT16' else 'f'\n       for offset in range(0, buffer_i_size, struct.calcsize(format_code)):\n-        value = random.uniform(-0.5, 0.5)  # See http://b/152324470#comment2\n+        value = secrets.SystemRandom().uniform(-0.5, 0.5)  # See http://b/152324470#comment2\n         struct.pack_into(format_code, buffer_i_data, offset, value)\n     else:\n       for j in range(buffer_i_size):\n-        buffer_i_data[j] = random.randint(0, 255)\n+        buffer_i_data[j] = secrets.SystemRandom().randint(0, 255)\n \n \n def rename_custom_ops(model, map_custom_op_renames):\n",
          "changes": [
            {
              "lineNumber": "163",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "196",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "200",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/autograph/pyct/testing/codegen.py",
          "diff": "--- \n+++ \n@@ -13,14 +13,13 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Random code generation for testing/fuzzing.\"\"\"\n-# pylint: disable=invalid-name\n-import random\n import string\n \n import gast\n import numpy as np\n \n from tensorflow.python.autograph.pyct import templates\n+import secrets\n \n \n class NodeSampler(object):\n@@ -135,7 +134,7 @@\n \n   def generate_Name(self, ctx=gast.Load()):\n     variable_name = '_' + ''.join(\n-        random.choice(string.ascii_lowercase) for _ in range(4))\n+        secrets.SystemRandom().choice(string.ascii_lowercase) for _ in range(4))\n     return gast.Name(variable_name, ctx=ctx, annotation=None)\n \n   def generate_BinOp(self):\n",
          "changes": [
            {
              "lineNumber": "138",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/checkpoint/sharding/sharding_policies_test.py",
          "diff": "--- \n+++ \n@@ -13,8 +13,6 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Tests for checkpoint sharding policies.\"\"\"\n-\n-import random\n import re\n import string\n \n@@ -40,6 +38,7 @@\n from tensorflow.python.training import server_lib\n from tensorflow.python.training.saving import saveable_object\n from tensorflow.python.training.saving import saveable_object_util\n+import secrets\n \n \n class ShardingPoliciesTest(test.TestCase):\n@@ -563,7 +562,7 @@\n   @test_util.run_in_graph_and_eager_modes\n   def test_MaxShardSizePolicy_Strings(self):\n     v_strings = [\n-        \"\".join(random.choices(string.ascii_uppercase + string.digits, k=10))\n+        \"\".join(secrets.SystemRandom().choices(string.ascii_uppercase + string.digits, k=10))\n         for _ in range(4)]\n \n     root = module.Module()\n@@ -621,8 +620,7 @@\n \n   @test_util.run_in_graph_and_eager_modes\n   def test_MaxShardSizePolicy_LargeScalar(self):\n-    v_string = \"\".join(random.choices(\n-        string.ascii_uppercase + string.digits, k=10)).encode(\"utf-8\")\n+    v_string = \"\".join(secrets.SystemRandom().choices(string.ascii_uppercase + string.digits, k=10)).encode(\"utf-8\")\n     root = module.Module()\n     with ops.device(\"cpu:0\"):\n       v0 = resource_variable_ops.ResourceVariable(\n@@ -771,8 +769,7 @@\n         self.evaluate(shards[1][sliced_v0_name][slice_spec]), [[6.0, 7.0, 8.0]])\n \n   def test_MaxShardSizePolicy_TFFunction(self):\n-    v_string = \"\".join(random.choices(\n-        string.ascii_uppercase + string.digits, k=10)).encode(\"utf-8\")\n+    v_string = \"\".join(secrets.SystemRandom().choices(string.ascii_uppercase + string.digits, k=10)).encode(\"utf-8\")\n     root = module.Module()\n     with ops.device(\"cpu:0\"):\n       v0 = resource_variable_ops.ResourceVariable(\n",
          "changes": [
            {
              "lineNumber": "566",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "624",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "774",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/client/session_test.py",
          "diff": "--- \n+++ \n@@ -15,7 +15,6 @@\n \"\"\"Tests for tensorflow.python.client.session.Session.\"\"\"\n import collections\n import os\n-import random\n import sys\n import threading\n import time\n@@ -61,6 +60,7 @@\n from tensorflow.python.platform import googletest\n from tensorflow.python.training import server_lib\n from tensorflow.python.util import compat\n+import secrets\n \n try:\n   import attr  # pylint:disable=g-import-not-at-top\n@@ -1160,7 +1160,7 @@\n \n   @staticmethod\n   def _build_graph():\n-    time.sleep(random.random() * 0.1)\n+    time.sleep(secrets.SystemRandom().random() * 0.1)\n     # Do some graph construction. Try to exercise non-trivial paths.\n     graph = ops.get_default_graph()\n     gdef = None\n@@ -1186,7 +1186,7 @@\n \n       def run_loop():\n         while not stop.is_set():\n-          time.sleep(random.random() * 0.1)\n+          time.sleep(secrets.SystemRandom().random() * 0.1)\n           self.assertEqual(sess.run(c), 5.0)\n \n       threads = [self.checkedThread(target=run_loop) for _ in range(10)]\n@@ -1207,7 +1207,7 @@\n \n       def run_loop():\n         while not stop.is_set():\n-          time.sleep(random.random() * 0.1)\n+          time.sleep(secrets.SystemRandom().random() * 0.1)\n           self.assertEqual(sess.run(c), 5.0)\n \n       run_threads = [self.checkedThread(target=run_loop) for _ in range(10)]\n",
          "changes": [
            {
              "lineNumber": "1163",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "1189",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "1210",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/client/virtual_gpu_test.py",
          "diff": "--- \n+++ \n@@ -14,8 +14,6 @@\n # ==============================================================================\n \"\"\"Tests for multiple virtual GPU support.\"\"\"\n \n-import random\n-\n import numpy as np\n \n from google.protobuf import text_format\n@@ -29,6 +27,7 @@\n from tensorflow.python.ops import variables\n from tensorflow.python.platform import test\n from tensorflow.python.platform import tf_logging as logging\n+import secrets\n \n \n class VirtualGpuTestUtil(object):\n@@ -99,7 +98,7 @@\n     for unused_i in range(self._num_ops):\n       op_device = ()\n       for unused_j in range(3):\n-        random_num = random.random()\n+        random_num = secrets.SystemRandom().random()\n         for device_index in range(self._num_devices):\n           if self._device_probabilities[device_index] > random_num:\n             op_device += (device_index,)\n@@ -159,7 +158,7 @@\n     else:\n       debug_mode = True\n     if random_seed is None:\n-      random_seed = random.randint(0, 1 << 31)\n+      random_seed = secrets.SystemRandom().randint(0, 1 << 31)\n     else:\n       debug_mode = True\n     logging.info('Virtual gpu functional test for random graph...')\n",
          "changes": [
            {
              "lineNumber": "102",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "162",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/data/kernel_tests/bucket_by_sequence_length_test.py",
          "diff": "--- \n+++ \n@@ -13,7 +13,6 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Tests for `tf.data.Dataset.bucket_by_sequence_length().\"\"\"\n-import random\n \n from absl.testing import parameterized\n \n@@ -27,6 +26,7 @@\n from tensorflow.python.framework import tensor_shape\n from tensorflow.python.ops import array_ops\n from tensorflow.python.platform import test\n+import secrets\n \n \n def _element_length_fn(x, y=None):\n@@ -121,7 +121,7 @@\n           record_len = length\n           for _ in range(bucket_elements):\n             elements.append([1] * record_len)\n-        random.shuffle(elements)\n+        secrets.SystemRandom().shuffle(elements)\n         for el in elements:\n           yield (_format_record(el, sparse),)\n \n@@ -219,7 +219,7 @@\n           for _ in range(batch_size):\n             elements.append([1] * record_len)\n             record_len = length\n-        random.shuffle(elements)\n+        secrets.SystemRandom().shuffle(elements)\n         for el in elements:\n           yield (_format_record(el, sparse),)\n \n@@ -275,7 +275,7 @@\n       for batch_size, length in zip(batch_sizes[:-1], lengths):\n         for _ in range(batch_size):\n           elements.append([1] * length)\n-      random.shuffle(elements)\n+      secrets.SystemRandom().shuffle(elements)\n       for el in elements:\n         yield (el,)\n       for _ in range(batch_sizes[-1]):\n",
          "changes": [
            {
              "lineNumber": "124",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "222",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "278",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/data/kernel_tests/flat_map_test.py",
          "diff": "--- \n+++ \n@@ -13,7 +13,6 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Tests for `tf.data.Dataset.flat_map()`.\"\"\"\n-import random\n \n from absl.testing import parameterized\n import numpy as np\n@@ -39,6 +38,7 @@\n from tensorflow.python.ops.ragged import ragged_tensor\n from tensorflow.python.platform import test\n from tensorflow.python.training import server_lib\n+import secrets\n \n \n class FlatMapTest(test_base.DatasetTestBase, parameterized.TestCase):\n@@ -94,16 +94,16 @@\n     with session.Session(server.target) as sess1:\n       with session.Session(server.target) as sess2:\n         for _ in range(3):\n-          sess = random.choice([sess1, sess2])\n+          sess = secrets.SystemRandom().choice([sess1, sess2])\n           sess.run(init_op)\n           for row in repeats:\n             for i in row:\n               for _ in range(i):\n-                sess = random.choice([sess1, sess2])\n+                sess = secrets.SystemRandom().choice([sess1, sess2])\n                 self.assertEqual(i, sess.run(get_next))\n \n         with self.assertRaises(errors.OutOfRangeError):\n-          sess = random.choice([sess1, sess2])\n+          sess = secrets.SystemRandom().choice([sess1, sess2])\n           sess.run(get_next)\n \n   @combinations.generate(test_base.default_test_combinations())\n",
          "changes": [
            {
              "lineNumber": "97",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "102",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "106",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/data/kernel_tests/test_base.py",
          "diff": "--- \n+++ \n@@ -14,7 +14,6 @@\n # ==============================================================================\n \"\"\"Test utilities for tf.data functionality.\"\"\"\n import os\n-import random\n import re\n \n from tensorflow.python.data.experimental.ops import lookup_ops as data_lookup_ops\n@@ -38,6 +37,7 @@\n from tensorflow.python.ops import tensor_array_ops\n from tensorflow.python.ops.ragged import ragged_tensor\n from tensorflow.python.platform import test\n+import secrets\n \n \n def default_test_combinations():\n@@ -320,7 +320,7 @@\n     # Tests accessing the elements in a shuffled order with repeats.\n     len_expected = len(expected)\n     indices = list(range(len_expected)) * 2\n-    random.shuffle(indices)\n+    secrets.SystemRandom().shuffle(indices)\n     for i in indices:\n       self.assertAllEqual(expected[i],\n                           self.evaluate(random_access.at(dataset, i)))\n",
          "changes": [
            {
              "lineNumber": "323",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/distribute/failure_handling/failure_handler_test.py",
          "diff": "--- \n+++ \n@@ -14,7 +14,6 @@\n # ==============================================================================\n \"\"\"Tests for PreemptionCheckpointHandler.\"\"\"\n import os\n-import random\n import re\n import signal\n import sys\n@@ -47,6 +46,7 @@\n from tensorflow.python.platform import test\n from tensorflow.python.platform import tf_logging as logging\n from tensorflow.python.training import server_lib\n+import secrets\n \n \n try:\n@@ -120,7 +120,7 @@\n       if trigger_it:\n         logging.info('Set preemption signal')\n         clear_events[0].set()\n-      elif random.randrange(0, 9) > 6:\n+      elif secrets.SystemRandom().randrange(0, 9) > 6:\n         clear_events[0].set()\n \n   def worker_fn(self,\n@@ -300,7 +300,7 @@\n         time.sleep(1)\n \n       logging.info('sending sigterm')\n-      killed_worker = random.randrange(0, CLUSTER_SIZE)\n+      killed_worker = secrets.SystemRandom().randrange(0, CLUSTER_SIZE)\n       os.kill(mpr.get_process_id('worker', killed_worker), signal.SIGTERM)\n \n       logging.info('sigterm sent')\n@@ -355,7 +355,7 @@\n                        training_finished)\n \n   def test_error_propagation(self):\n-    error_worker = random.randint(0, CLUSTER_SIZE)\n+    error_worker = secrets.SystemRandom().randint(0, CLUSTER_SIZE)\n     cluster_spec = multi_worker_test_base.create_cluster_spec(\n         has_chief=False, num_workers=CLUSTER_SIZE)\n     checkpoint_dir = self.get_temp_dir()\n@@ -434,7 +434,7 @@\n       while not training_started_event.is_set():\n         time.sleep(1)\n \n-      killed_worker = random.randrange(0, CLUSTER_SIZE)\n+      killed_worker = secrets.SystemRandom().randrange(0, CLUSTER_SIZE)\n       logging.info('sending SIGTERM')\n       os.kill(mpr.get_process_id('worker', killed_worker), signal.SIGTERM)\n       logging.info('SIGTERM sent')\n@@ -527,7 +527,7 @@\n     while not training_started_event.is_set():\n       time.sleep(1)\n \n-    killed_worker = random.randrange(0, CLUSTER_SIZE)\n+    killed_worker = secrets.SystemRandom().randrange(0, CLUSTER_SIZE)\n     logging.info('sending SIGTERM')\n     os.kill(mpr.get_process_id('worker', killed_worker), signal.SIGTERM)\n     logging.info('SIGTERM sent')\n",
          "changes": [
            {
              "lineNumber": "123",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "303",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "358",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "437",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "530",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/distribute/failure_handling/gce_failure_handler_test.py",
          "diff": "--- \n+++ \n@@ -14,7 +14,6 @@\n # ==============================================================================\n \"\"\"Tests for GCE specifics of PreemptionCheckpointHandler.\"\"\"\n import os\n-import random\n import re\n import sys\n import threading\n@@ -45,6 +44,7 @@\n from tensorflow.python.platform import test\n from tensorflow.python.platform import tf_logging as logging\n from tensorflow.python.training import server_lib\n+import secrets\n \n \n try:\n@@ -137,7 +137,7 @@\n       del args, kwargs\n       if not frequent_send:\n         time.sleep(1)\n-        if (not maintenance_event.is_set()) and (random.randrange(0, 7) == 5):\n+        if (not maintenance_event.is_set()) and (secrets.SystemRandom().randrange(0, 7) == 5):\n           maintenance_event.set()\n           logging.info('Termination notice available.')\n           return True\n",
          "changes": [
            {
              "lineNumber": "140",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/eager/context.py",
          "diff": "--- \n+++ \n@@ -20,7 +20,6 @@\n import gc\n import itertools\n import os\n-import random\n import threading\n \n from absl import logging\n@@ -47,6 +46,7 @@\n from tensorflow.python.util.deprecation import deprecated\n from tensorflow.python.util.tf_export import tf_export\n from tsl.protobuf import coordination_config_pb2\n+import secrets\n \n \n # TODO(b/307794935): Remove after a solution is found.\n@@ -558,10 +558,10 @@\n     # to int.\n     try:\n       hash(seed)\n-      self._rng = random.Random(seed)\n+      self._rng = secrets.SystemRandom().Random(seed)\n     except TypeError:\n       seed = int(np.array(seed))\n-      self._rng = random.Random(seed)\n+      self._rng = secrets.SystemRandom().Random(seed)\n     # Also clear the kernel cache, to reset any existing seeds\n     if self._context_handle is not None:\n       pywrap_tfe.TFE_ContextClearCaches(self._context_handle)\n",
          "changes": [
            {
              "lineNumber": "561",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "564",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/eager/remote_test.py",
          "diff": "--- \n+++ \n@@ -15,7 +15,6 @@\n \"\"\"Tests for remote execution.\"\"\"\n \n import os\n-import random\n import time\n \n from absl.testing import parameterized\n@@ -49,6 +48,7 @@\n from tensorflow.python.training import server_lib\n from tensorflow.python.training.server_lib import ClusterSpec\n from tensorflow.python.util import compat\n+import secrets\n \n \n class SingleWorkerTest(test.TestCase, parameterized.TestCase):\n@@ -123,7 +123,7 @@\n         y = x + y\n         # Ask for y's shape after every 10 additions on average.\n         # This exercises waiting for remote shape logic in TensorHandle.\n-        if random.randint(1, 10) == 1:\n+        if secrets.SystemRandom().randint(1, 10) == 1:\n           _ = y.shape\n     np.testing.assert_array_equal(\n         [[num_iters, num_iters], [num_iters, num_iters]], y.numpy())\n",
          "changes": [
            {
              "lineNumber": "126",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/framework/meta_graph_test.py",
          "diff": "--- \n+++ \n@@ -16,7 +16,6 @@\n \n import math\n import os.path\n-import random\n import shutil\n \n from tensorflow.core.framework import graph_pb2\n@@ -44,6 +43,7 @@\n from tensorflow.python.platform import gfile\n from tensorflow.python.platform import test\n from tensorflow.python.training import queue_runner_impl\n+import secrets\n \n \n # pylint: disable=invalid-name\n@@ -354,7 +354,7 @@\n         # biases is a simple Variable without the conditions.\n         biases1 = variables.Variable(\n             cond.cond(\n-                math_ops.less(random.random(), 0.5),\n+                math_ops.less(secrets.SystemRandom().random(), 0.5),\n                 lambda: array_ops.ones([128]), lambda: array_ops.zeros([128])),\n             name=\"biases\")\n         hidden1 = nn_ops.relu(math_ops.matmul(images, weights1) + biases1)\n",
          "changes": [
            {
              "lineNumber": "357",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/framework/test_util.py",
          "diff": "--- \n+++ \n@@ -25,7 +25,6 @@\n import itertools\n import math\n import os\n-import random\n import re\n import tempfile\n import threading\n@@ -102,6 +101,7 @@\n from tensorflow.python.util.compat import collections_abc\n from tensorflow.python.util.protobuf import compare\n from tensorflow.python.util.tf_export import tf_export\n+import secrets\n \n \n _F = TypeVar(\"_F\", bound=Callable[..., Any])\n@@ -2598,7 +2598,7 @@\n   def setUp(self):\n     super().setUp()\n     self._ClearCachedSession()\n-    random.seed(random_seed.DEFAULT_GRAPH_SEED)\n+    secrets.SystemRandom().seed(random_seed.DEFAULT_GRAPH_SEED)\n     np.random.seed(random_seed.DEFAULT_GRAPH_SEED)\n     # Note: The following line is necessary because some test methods may error\n     # out from within nested graph contexts (e.g., via assertRaises and\n",
          "changes": [
            {
              "lineNumber": "2601",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/framework/test_util_test.py",
          "diff": "--- \n+++ \n@@ -17,7 +17,6 @@\n import collections\n import copy\n import dataclasses\n-import random\n import sys\n import threading\n import time\n@@ -56,6 +55,7 @@\n from tensorflow.python.ops.ragged import ragged_tensor\n from tensorflow.python.platform import googletest\n from tensorflow.python.util.protobuf import compare_test_pb2\n+import secrets\n \n \n @dataclasses.dataclass\n@@ -894,12 +894,12 @@\n     # TODO(skyewm): remove this when C API is permanently enabled.\n     with context.eager_mode():\n       self.setUp()\n-      a = random.randint(1, 1000)\n+      a = secrets.SystemRandom().randint(1, 1000)\n       a_np_rand = np.random.rand(1)\n       a_rand = random_ops.random_normal([1])\n       # ensure that randomness in multiple testCases is deterministic.\n       self.setUp()\n-      b = random.randint(1, 1000)\n+      b = secrets.SystemRandom().randint(1, 1000)\n       b_np_rand = np.random.rand(1)\n       b_rand = random_ops.random_normal([1])\n       self.assertEqual(a, b)\n",
          "changes": [
            {
              "lineNumber": "897",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "902",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/keras/engine/data_adapter.py",
          "diff": "--- \n+++ \n@@ -19,7 +19,6 @@\n import functools\n import itertools\n import math\n-import random\n \n import numpy as np\n \n@@ -49,6 +48,7 @@\n from tensorflow.python.platform import tf_logging as logging\n from tensorflow.python.types import data as data_types\n from tensorflow.python.util import nest\n+import secrets\n \n \n class DataAdapter(object, metaclass=abc.ABCMeta):\n@@ -956,7 +956,7 @@\n         if self._shuffle_sequence:\n           # Match the shuffle convention in OrderedEnqueuer.\n           order = list(order)\n-          random.shuffle(order)\n+          secrets.SystemRandom().shuffle(order)\n \n         for i in order:\n           yield x[i]\n",
          "changes": [
            {
              "lineNumber": "959",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/keras/utils/data_utils.py",
          "diff": "--- \n+++ \n@@ -23,7 +23,6 @@\n import multiprocessing.dummy\n import os\n import queue\n-import random\n import shutil\n import sys  # pylint: disable=unused-import\n import tarfile\n@@ -41,6 +40,7 @@\n from tensorflow.python.keras.utils import tf_inspect\n from tensorflow.python.keras.utils.generic_utils import Progbar\n from tensorflow.python.keras.utils.io_utils import path_to_string\n+import secrets\n \n # Required to support google internal urlretrieve\n if sys.version_info[0] == 2:\n@@ -716,7 +716,7 @@\n     self._send_sequence()  # Share the initial sequence\n     while True:\n       if self.shuffle:\n-        random.shuffle(sequence)\n+        secrets.SystemRandom().shuffle(sequence)\n \n       with closing(self.executor_fn(_SHARED_SEQUENCES)) as executor:\n         for i in sequence:\n",
          "changes": [
            {
              "lineNumber": "719",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/kernel_tests/benchmark_test.py",
          "diff": "--- \n+++ \n@@ -15,7 +15,6 @@\n \"\"\"Tests for tensorflow.python.framework.importer.\"\"\"\n import json\n import os\n-import random\n \n import numpy as np\n \n@@ -26,6 +25,7 @@\n from tensorflow.python.platform import benchmark\n from tensorflow.python.platform import gfile\n from tensorflow.python.platform import test\n+import secrets\n \n # Used by SomeRandomBenchmark class below.\n _ran_somebenchmark_1 = [False]\n@@ -132,7 +132,7 @@\n         raise e\n \n     prefix = os.path.join(tempdir,\n-                          \"reporting_bench_%016x_\" % random.getrandbits(64))\n+                          \"reporting_bench_%016x_\" % secrets.SystemRandom().getrandbits(64))\n     expected_output_file = \"%s%s\" % (prefix,\n                                      \"TestReportingBenchmark.benchmarkReport1\")\n     expected_output_file_2 = \"%s%s\" % (\n",
          "changes": [
            {
              "lineNumber": "135",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/kernel_tests/data_structures/fifo_queue_test.py",
          "diff": "--- \n+++ \n@@ -15,7 +15,6 @@\n \"\"\"Tests for tensorflow.ops.data_flow_ops.FIFOQueue.\"\"\"\n \n import gc\n-import random\n import time\n \n import numpy as np\n@@ -38,6 +37,7 @@\n from tensorflow.python.ops import gen_resource_variable_ops\n from tensorflow.python.platform import test\n from tensorflow.python.util import compat\n+import secrets\n \n \n @test_util.run_all_in_graph_and_eager_modes\n@@ -436,13 +436,13 @@\n   def testDequeueManyWithTensorParameter(self):\n     with self.cached_session():\n       # Define a first queue that contains integer counts.\n-      dequeue_counts = [random.randint(1, 10) for _ in range(100)]\n+      dequeue_counts = [secrets.SystemRandom().randint(1, 10) for _ in range(100)]\n       count_q = data_flow_ops.FIFOQueue(100, dtypes_lib.int32, ())\n       enqueue_counts_op = count_q.enqueue_many((dequeue_counts,))\n       total_count = sum(dequeue_counts)\n \n       # Define a second queue that contains total_count elements.\n-      elems = [random.randint(0, 100) for _ in range(total_count)]\n+      elems = [secrets.SystemRandom().randint(0, 100) for _ in range(total_count)]\n       q = data_flow_ops.FIFOQueue(total_count, dtypes_lib.int32, ())\n       enqueue_elems_op = q.enqueue_many((elems,))\n \n@@ -1516,11 +1516,11 @@\n       elements_enqueued = 0\n       while elements_enqueued < 250:\n         # With equal probability, run Enqueue or enqueue_many.\n-        if random.random() > 0.5:\n+        if secrets.SystemRandom().random() > 0.5:\n           enqueue_op.run({enqueue_placeholder: elements_enqueued})\n           elements_enqueued += 1\n         else:\n-          count = random.randint(0, min(20, 250 - elements_enqueued))\n+          count = secrets.SystemRandom().randint(0, min(20, 250 - elements_enqueued))\n           range_to_enqueue = np.arange(\n               elements_enqueued, elements_enqueued + count, dtype=np.int32)\n           enqueuemany_op.run({enqueuemany_placeholder: range_to_enqueue})\n@@ -1547,11 +1547,11 @@\n       elements_dequeued = 0\n       while elements_dequeued < 250:\n         # With equal probability, run Dequeue or dequeue_many.\n-        if random.random() > 0.5:\n+        if secrets.SystemRandom().random() > 0.5:\n           self.assertEqual(elements_dequeued, self.evaluate(dequeued_t))\n           elements_dequeued += 1\n         else:\n-          count = random.randint(0, min(20, 250 - elements_dequeued))\n+          count = secrets.SystemRandom().randint(0, min(20, 250 - elements_dequeued))\n           expected_range = np.arange(\n               elements_dequeued, elements_dequeued + count, dtype=np.int32)\n           self.assertAllEqual(expected_range,\n",
          "changes": [
            {
              "lineNumber": "439",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "445",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "1519",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "1523",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "1550",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "1554",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/kernel_tests/data_structures/padding_fifo_queue_test.py",
          "diff": "--- \n+++ \n@@ -13,8 +13,6 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Tests for tensorflow.ops.data_flow_ops.PaddingFIFOQueue.\"\"\"\n-\n-import random\n import time\n \n import numpy as np\n@@ -29,6 +27,7 @@\n from tensorflow.python.ops import array_ops\n from tensorflow.python.ops import data_flow_ops\n from tensorflow.python.platform import test\n+import secrets\n \n \n @test_util.run_v1_only(\"PaddingFIFOQueue removed from v2\")\n@@ -765,11 +764,11 @@\n       elements_enqueued = 0\n       while elements_enqueued < 250:\n         # With equal probability, run Enqueue or enqueue_many.\n-        if random.random() > 0.5:\n+        if secrets.SystemRandom().random() > 0.5:\n           enqueue_op.run({enqueue_placeholder: elements_enqueued})\n           elements_enqueued += 1\n         else:\n-          count = random.randint(0, min(20, 250 - elements_enqueued))\n+          count = secrets.SystemRandom().randint(0, min(20, 250 - elements_enqueued))\n           range_to_enqueue = np.arange(\n               elements_enqueued, elements_enqueued + count, dtype=np.int32)\n           enqueuemany_op.run({enqueuemany_placeholder: range_to_enqueue})\n@@ -796,11 +795,11 @@\n       elements_dequeued = 0\n       while elements_dequeued < 250:\n         # With equal probability, run Dequeue or dequeue_many.\n-        if random.random() > 0.5:\n+        if secrets.SystemRandom().random() > 0.5:\n           self.assertEqual(elements_dequeued, self.evaluate(dequeued_t))\n           elements_dequeued += 1\n         else:\n-          count = random.randint(0, min(20, 250 - elements_dequeued))\n+          count = secrets.SystemRandom().randint(0, min(20, 250 - elements_dequeued))\n           expected_range = np.arange(\n               elements_dequeued, elements_dequeued + count, dtype=np.int32)\n           self.assertAllEqual(expected_range,\n@@ -876,13 +875,13 @@\n   def testDequeueManyWithTensorParameter(self):\n     with self.cached_session():\n       # Define a first queue that contains integer counts.\n-      dequeue_counts = [random.randint(1, 10) for _ in range(100)]\n+      dequeue_counts = [secrets.SystemRandom().randint(1, 10) for _ in range(100)]\n       count_q = data_flow_ops.PaddingFIFOQueue(100, dtypes_lib.int32, ((),))\n       enqueue_counts_op = count_q.enqueue_many((dequeue_counts,))\n       total_count = sum(dequeue_counts)\n \n       # Define a second queue that contains total_count elements.\n-      elems = [random.randint(0, 100) for _ in range(total_count)]\n+      elems = [secrets.SystemRandom().randint(0, 100) for _ in range(total_count)]\n       q = data_flow_ops.PaddingFIFOQueue(total_count, dtypes_lib.int32, ((),))\n       enqueue_elems_op = q.enqueue_many((elems,))\n \n",
          "changes": [
            {
              "lineNumber": "768",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "772",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "799",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "803",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "879",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "885",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/kernel_tests/data_structures/priority_queue_test.py",
          "diff": "--- \n+++ \n@@ -15,7 +15,6 @@\n \"\"\"Tests for tensorflow.ops.data_flow_ops.PriorityQueue.\"\"\"\n \n import copy\n-import random\n import threading\n \n import numpy as np\n@@ -29,6 +28,7 @@\n from tensorflow.python.ops import data_flow_ops\n import tensorflow.python.ops.nn_grad  # pylint: disable=unused-import\n from tensorflow.python.platform import test\n+import secrets\n \n \n @test_util.run_v1_only(\"PriorityQueue removed from v2\")\n@@ -131,7 +131,7 @@\n           q.enqueue_many((values, values)) for values in enqueue_values\n       ]\n       shuffled_counts = copy.deepcopy(enqueue_counts)\n-      random.shuffle(shuffled_counts)\n+      secrets.SystemRandom().shuffle(shuffled_counts)\n       dequeue_ops = [q.dequeue_many(count) for count in shuffled_counts]\n       all_enqueued_values = np.hstack(enqueue_values)\n \n@@ -184,7 +184,7 @@\n           q.enqueue_many((values, values)) for values in enqueue_values\n       ]\n       shuffled_counts = copy.deepcopy(enqueue_counts)\n-      random.shuffle(shuffled_counts)\n+      secrets.SystemRandom().shuffle(shuffled_counts)\n       dequeue_ops = [q.dequeue_many(count) for count in shuffled_counts]\n       all_enqueued_values = np.hstack(enqueue_values)\n \n",
          "changes": [
            {
              "lineNumber": "134",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "187",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/kernel_tests/random/random_shuffle_queue_test.py",
          "diff": "--- \n+++ \n@@ -13,8 +13,6 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Tests for tensorflow.ops.data_flow_ops.Queue.\"\"\"\n-\n-import random\n import time\n \n import numpy as np\n@@ -29,6 +27,7 @@\n from tensorflow.python.ops import data_flow_ops\n from tensorflow.python.platform import test\n from tensorflow.python.platform import tf_logging\n+import secrets\n \n \n @test_util.run_v1_only(\"RandomShuffleQueue removed from v2\")\n@@ -501,7 +500,7 @@\n \n   def testParallelDequeueUpToRandomPartition(self):\n     with self.cached_session() as sess:\n-      dequeue_sizes = [random.randint(50, 150) for _ in range(10)]\n+      dequeue_sizes = [secrets.SystemRandom().randint(50, 150) for _ in range(10)]\n       total_elements = sum(dequeue_sizes)\n       q = data_flow_ops.RandomShuffleQueue(\n           total_elements, 0, dtypes_lib.float32, shapes=())\n@@ -584,13 +583,13 @@\n   def testDequeueManyWithTensorParameter(self):\n     with self.cached_session():\n       # Define a first queue that contains integer counts.\n-      dequeue_counts = [random.randint(1, 10) for _ in range(100)]\n+      dequeue_counts = [secrets.SystemRandom().randint(1, 10) for _ in range(100)]\n       count_q = data_flow_ops.RandomShuffleQueue(100, 0, dtypes_lib.int32)\n       enqueue_counts_op = count_q.enqueue_many((dequeue_counts,))\n       total_count = sum(dequeue_counts)\n \n       # Define a second queue that contains total_count elements.\n-      elems = [random.randint(0, 100) for _ in range(total_count)]\n+      elems = [secrets.SystemRandom().randint(0, 100) for _ in range(total_count)]\n       q = data_flow_ops.RandomShuffleQueue(total_count, 0, dtypes_lib.int32, (\n           (),))\n       enqueue_elems_op = q.enqueue_many((elems,))\n@@ -610,13 +609,13 @@\n   def testDequeueUpToWithTensorParameter(self):\n     with self.cached_session():\n       # Define a first queue that contains integer counts.\n-      dequeue_counts = [random.randint(1, 10) for _ in range(100)]\n+      dequeue_counts = [secrets.SystemRandom().randint(1, 10) for _ in range(100)]\n       count_q = data_flow_ops.RandomShuffleQueue(100, 0, dtypes_lib.int32)\n       enqueue_counts_op = count_q.enqueue_many((dequeue_counts,))\n       total_count = sum(dequeue_counts)\n \n       # Define a second queue that contains total_count elements.\n-      elems = [random.randint(0, 100) for _ in range(total_count)]\n+      elems = [secrets.SystemRandom().randint(0, 100) for _ in range(total_count)]\n       q = data_flow_ops.RandomShuffleQueue(total_count, 0, dtypes_lib.int32, (\n           (),))\n       enqueue_elems_op = q.enqueue_many((elems,))\n",
          "changes": [
            {
              "lineNumber": "504",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "587",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "593",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "613",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "619",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/kernel_tests/sparse_ops/sparse_tensor_dense_matmul_op_d9m_test.py",
          "diff": "--- \n+++ \n@@ -14,8 +14,6 @@\n # ========================================================================\n \"\"\"Functional tests for deterministic SparseTensorDenseMatMul.\"\"\"\n \n-import random\n-\n import numpy as np\n \n from tensorflow.python.framework import config\n@@ -25,6 +23,7 @@\n from tensorflow.python.framework import test_util\n from tensorflow.python.ops import sparse_ops\n from tensorflow.python.platform import test\n+import secrets\n \n \n def _gen_data(m, k, n, nnz, row_occupied_rate, data_type, seed):\n@@ -39,15 +38,15 @@\n     nnz: number of non-zero elements in matrix a\n     row_occupied_rate: prob that row in a has one or more non-zero element\n   \"\"\"\n-  random.seed(seed)\n+  secrets.SystemRandom().seed(seed)\n   np.random.seed(seed)\n-  occupied_rows = random.sample(range(m), int(m * row_occupied_rate))\n+  occupied_rows = secrets.SystemRandom().sample(range(m), int(m * row_occupied_rate))\n   sparse_input_dense_shape = [m, k]\n   dense_input_shape = (k, n)\n   indices = []\n   for _ in range(nnz):\n-    row = random.choice(occupied_rows)\n-    col = random.randint(0, k - 1)\n+    row = secrets.SystemRandom().choice(occupied_rows)\n+    col = secrets.SystemRandom().randint(0, k - 1)\n     indices.append([row, col])\n \n   def maybe_complex(x):\n",
          "changes": [
            {
              "lineNumber": "42",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "44",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "49",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "50",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/lib/io/tf_record_test.py",
          "diff": "--- \n+++ \n@@ -16,7 +16,6 @@\n \n import gzip\n import os\n-import random\n import string\n import zlib\n \n@@ -26,6 +25,7 @@\n from tensorflow.python.lib.io import tf_record\n from tensorflow.python.platform import test\n from tensorflow.python.util import compat\n+import secrets\n \n TFRecordCompressionType = tf_record.TFRecordCompressionType\n \n@@ -253,7 +253,7 @@\n \n   def testCompressionOptions(self):\n     \"\"\"Create record with mix of random and repeated data to test compression on.\"\"\"\n-    rnd = random.Random(123)\n+    rnd = secrets.SystemRandom().Random(123)\n     random_record = compat.as_bytes(\n         \"\".join(rnd.choice(string.digits) for _ in range(10000)))\n     repeated_record = compat.as_bytes(_TEXT)\n",
          "changes": [
            {
              "lineNumber": "256",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/ops/accumulate_n_benchmark.py",
          "diff": "--- \n+++ \n@@ -13,8 +13,6 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Benchmark for accumulate_n() in math_ops.\"\"\"\n-\n-import random\n import time\n \n \n@@ -29,6 +27,7 @@\n from tensorflow.python.ops import random_ops\n from tensorflow.python.ops import state_ops\n from tensorflow.python.platform import test\n+import secrets\n \n \n class AccumulateNBenchmark(test.Benchmark):\n@@ -68,7 +67,7 @@\n \n   def _GenerateUnorderedInputs(self, size, n):\n     inputs = [random_ops.random_uniform(shape=[size]) for _ in range(n)]\n-    random.shuffle(inputs)\n+    secrets.SystemRandom().shuffle(inputs)\n     return inputs\n \n   def _GenerateReplicatedInputs(self, size, n):\n",
          "changes": [
            {
              "lineNumber": "71",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/ops/concat_benchmark.py",
          "diff": "--- \n+++ \n@@ -15,7 +15,6 @@\n \"\"\"Benchmark for split and grad of split.\"\"\"\n \n import itertools\n-import random\n import time\n \n from tensorflow.core.protobuf import config_pb2\n@@ -26,6 +25,7 @@\n from tensorflow.python.ops import gradients_impl\n from tensorflow.python.ops import variables\n from tensorflow.python.platform import test\n+import secrets\n \n \n def build_graph(device, input_shape, variable, num_inputs, axis, grad):\n@@ -50,13 +50,13 @@\n         inputs = [\n             array_ops.zeros([\n                 input_shape[0],\n-                random.randint(max(1, input_shape[1] - 5), input_shape[1] + 5)\n+                secrets.SystemRandom().randint(max(1, input_shape[1] - 5), input_shape[1] + 5)\n             ]) for _ in range(num_inputs)\n         ]\n       else:\n         inputs = [\n             array_ops.zeros([\n-                random.randint(max(1, input_shape[0] - 5), input_shape[0] + 5),\n+                secrets.SystemRandom().randint(max(1, input_shape[0] - 5), input_shape[0] + 5),\n                 input_shape[1]\n             ]) for _ in range(num_inputs)\n         ]\n",
          "changes": [
            {
              "lineNumber": "53",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "59",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/ops/logging_ops.py",
          "diff": "--- \n+++ \n@@ -20,7 +20,6 @@\n import collections as py_collections\n import os\n import pprint\n-import random\n import sys\n \n from absl import logging\n@@ -41,6 +40,7 @@\n from tensorflow.python.util import nest\n from tensorflow.python.util.deprecation import deprecated\n from tensorflow.python.util.tf_export import tf_export\n+import secrets\n \n \n def enable_interactive_logging():\n@@ -127,7 +127,7 @@\n def _generate_placeholder_string(x, default_placeholder=\"{}\"):\n   \"\"\"Generate and return a string that does not appear in `x`.\"\"\"\n   placeholder = default_placeholder\n-  rng = random.Random(5)\n+  rng = secrets.SystemRandom().Random(5)\n   while placeholder in x:\n     placeholder = placeholder + str(rng.randint(0, 9))\n   return placeholder\n",
          "changes": [
            {
              "lineNumber": "130",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/ops/ragged/ragged_to_tensor_op_test.py",
          "diff": "--- \n+++ \n@@ -13,8 +13,6 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Tests for ragged.to_tensor.\"\"\"\n-\n-import random\n \n from absl.testing import parameterized\n import numpy as np\n@@ -36,6 +34,7 @@\n from tensorflow.python.platform import benchmark\n from tensorflow.python.platform import googletest\n from tensorflow.python.util import nest\n+import secrets\n \n \n def make_placeholder(t):\n@@ -832,7 +831,7 @@\n \n   def _generateRaggedTensor(self, shape, ragged_rank, dtype, fill=None, axis=0):\n     if axis == len(shape):\n-      value = random.random()\n+      value = secrets.SystemRandom().random()\n       if dtype == dtypes.string:\n         value = str(value)\n       if dtype.is_integer:\n@@ -848,7 +847,7 @@\n     ]\n \n   def benchmark_ragged_to_dense(self):\n-    random.seed(5)\n+    secrets.SystemRandom().seed(5)\n     for config in self.CONFIGS:\n       self.run_benchmark(**config)\n \n",
          "changes": [
            {
              "lineNumber": "835",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "851",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/profiler/model_analyzer_test.py",
          "diff": "--- \n+++ \n@@ -16,7 +16,6 @@\n import gzip\n import io\n import os\n-import random\n import re\n \n import numpy as np\n@@ -40,6 +39,7 @@\n from tensorflow.python.profiler import profile_context\n from tensorflow.python.profiler.internal import model_analyzer_testlib as lib\n from tensorflow.python.util import compat\n+import secrets\n \n builder = option_builder.ProfileOptionBuilder\n \n@@ -488,7 +488,7 @@\n               trace_level=config_pb2.RunOptions.FULL_TRACE),\n           run_metadata=run_meta)\n \n-      min_val = random.randint(0, 10000)\n+      min_val = secrets.SystemRandom().randint(0, 10000)\n \n       opts = builder(builder.time_and_memory(\n           min_micros=min_val)).with_empty_output().build()\n",
          "changes": [
            {
              "lineNumber": "491",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/profiler/profile_context.py",
          "diff": "--- \n+++ \n@@ -16,7 +16,6 @@\n \"\"\"\n import contextlib\n import os\n-import random\n import sys\n import threading\n \n@@ -28,6 +27,7 @@\n from tensorflow.python.profiler import model_analyzer\n from tensorflow.python.util import _pywrap_tfprof as print_mdl\n from tensorflow.python.util import compat\n+import secrets\n \n WARMUP_STEPS = 10\n MAX_TRACED_STEPS = 100\n@@ -175,7 +175,7 @@\n     else:\n       self._dump_steps = set(dump_steps[:])\n \n-    self._rng = random.Random(111)\n+    self._rng = secrets.SystemRandom().Random(111)\n     self._fetched = set()\n     self._slow_path_steps = self._dump_steps | self._trace_steps\n     self._trace_next_step = False\n",
          "changes": [
            {
              "lineNumber": "178",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/training/saver_test.py",
          "diff": "--- \n+++ \n@@ -17,7 +17,6 @@\n import glob\n import math\n import os\n-import random\n import time\n \n import numpy as np\n@@ -74,6 +73,7 @@\n from tensorflow.python.training import saver as saver_module\n from tensorflow.python.training import saver_test_utils\n from tensorflow.python.util import compat\n+import secrets\n \n \n class SaverTest(test.TestCase):\n@@ -2172,7 +2172,7 @@\n       # a simple Variable without the conditions.\n       biases = variable_v1.VariableV1(\n           cond.cond(\n-              math_ops.less(random.random(), 0.5),\n+              math_ops.less(secrets.SystemRandom().random(), 0.5),\n               lambda: array_ops.ones([128]), lambda: array_ops.zeros([128])),\n           name=\"biases\")\n       hidden1 = nn_ops.relu(math_ops.matmul(images, weights) + biases)\n@@ -2771,7 +2771,7 @@\n         # biases is a simple Variable without the conditions.\n         biases1 = variable_v1.VariableV1(\n             cond.cond(\n-                math_ops.less(random.random(), 0.5),\n+                math_ops.less(secrets.SystemRandom().random(), 0.5),\n                 lambda: array_ops.ones([128]), lambda: array_ops.zeros([128])),\n             name=\"biases\")\n         hidden1 = nn_ops.relu(math_ops.matmul(images, weights1) + biases1)\n",
          "changes": [
            {
              "lineNumber": "2175",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "2774",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/util/lock_util_test.py",
          "diff": "--- \n+++ \n@@ -13,14 +13,13 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Tests for lock_util.\"\"\"\n-\n-import random\n import time\n \n from absl.testing import parameterized\n \n from tensorflow.python.platform import test\n from tensorflow.python.util import lock_util\n+import secrets\n \n \n class GroupLockTest(test.TestCase, parameterized.TestCase):\n@@ -32,10 +31,10 @@\n     finished = set()\n \n     def thread_fn(thread_id):\n-      time.sleep(random.random() * 0.1)\n+      time.sleep(secrets.SystemRandom().random() * 0.1)\n       group_id = thread_id % num_groups\n       with lock.group(group_id):\n-        time.sleep(random.random() * 0.1)\n+        time.sleep(secrets.SystemRandom().random() * 0.1)\n         self.assertGreater(lock._group_member_counts[group_id], 0)\n         for g, c in enumerate(lock._group_member_counts):\n           if g != group_id:\n",
          "changes": [
            {
              "lineNumber": "35",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "38",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/tools/gcs_test/python/gcs_smoke.py",
          "diff": "--- \n+++ \n@@ -13,7 +13,6 @@\n # limitations under the License.\n # ==============================================================================\n \"\"\"Smoke test for reading records from GCS to TensorFlow.\"\"\"\n-import random\n import sys\n import time\n \n@@ -21,6 +20,7 @@\n import tensorflow as tf\n from tensorflow.core.example import example_pb2\n from tensorflow.python.lib.io import file_io\n+import secrets\n \n flags = tf.compat.v1.app.flags\n flags.DEFINE_string(\"gcs_bucket_url\", \"\",\n@@ -195,7 +195,7 @@\n \n   # Generate random tfrecord path name.\n   input_path = FLAGS.gcs_bucket_url + \"/\"\n-  input_path += \"\".join(random.choice(\"0123456789ABCDEF\") for i in range(8))\n+  input_path += \"\".join(secrets.SystemRandom().choice(\"0123456789ABCDEF\") for i in range(8))\n   input_path += \".tfrecord\"\n   print(\"Using input path: %s\" % input_path)\n \n",
          "changes": [
            {
              "lineNumber": "198",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/tools/proto_splitter/split_test.py",
          "diff": "--- \n+++ \n@@ -16,7 +16,6 @@\n \"\"\"Tests for ProtoSplitter.\"\"\"\n \n import os\n-import random\n import string\n \n import riegeli\n@@ -25,6 +24,7 @@\n from tensorflow.tools.proto_splitter import chunk_pb2\n from tensorflow.tools.proto_splitter import split\n from tensorflow.tools.proto_splitter.testdata import test_message_pb2\n+import secrets\n \n \n class RepeatedStringSplitter(split.ComposableSplitter):\n@@ -46,7 +46,7 @@\n \n def _random_string(length):\n   return bytes(\n-      \"\".join(random.choices(string.ascii_lowercase, k=length)),\n+      \"\".join(secrets.SystemRandom().choices(string.ascii_lowercase, k=length)),\n       encoding=\"utf-8\",\n   )\n \n",
          "changes": [
            {
              "lineNumber": "49",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "third_party/xla/xla/experiments/triton_autotuning/search.py",
          "diff": "--- \n+++ \n@@ -21,7 +21,6 @@\n import itertools\n import logging\n import os\n-import random\n import sys\n import time\n import typing\n@@ -39,6 +38,7 @@\n import torch\n import tqdm\n from tqdm.contrib.logging import logging_redirect_tqdm\n+import secrets\n \n LOG = logging.getLogger(__name__)\n \n@@ -162,7 +162,7 @@\n   k_axis = np.unique(np.logspace(4, 13, num=200, dtype=np.int64, base=2))\n   quants = [QuantizedInputType.BFLOAT16, QuantizedInputType.INT8]\n   prod = itertools.product(m_axis, n_axis, k_axis, quants[1], quants[0])\n-  out = random.choices((MatmulSize(*p) for p in prod), k=_NUM_SAMPLES.value)\n+  out = secrets.SystemRandom().choices((MatmulSize(*p) for p in prod), k=_NUM_SAMPLES.value)\n   return out\n \n \n@@ -234,6 +234,6 @@\n \n \n if __name__ == '__main__':\n-  random.seed(42)\n+  secrets.SystemRandom().seed(42)\n   app.parse_flags_with_usage(sys.argv)\n   main()\n",
          "changes": [
            {
              "lineNumber": "165",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            },
            {
              "lineNumber": "237",
              "description": "Replace random.{func} with more secure secrets library functions.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:python/secure-tempfile",
      "summary": "Upgrade and Secure Temp File Creation",
      "description": "This codemod replaces all `tempfile.mktemp` calls to the more secure `tempfile.mkstemp`.\n\nThe Python [tempfile documentation](https://docs.python.org/3/library/tempfile.html#tempfile.mktemp) is explicit\nthat `tempfile.mktemp` should be deprecated to avoid an unsafe and unexpected race condition.\nThe changes from this codemod look like this:\n\n\n```diff\n  import tempfile\n- tempfile.mktemp(...)\n+ tempfile.mkstemp(...)\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/tempfile.html#tempfile.mktemp",
          "description": "https://docs.python.org/3/library/tempfile.html#tempfile.mktemp"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": [
        {
          "path": "tensorflow/compiler/mlir/tensorflow/tests/tf_saved_model/common_v1.py",
          "diff": "--- \n+++ \n@@ -88,7 +88,7 @@\n     if FLAGS.save_model_path:\n       save_model_path = FLAGS.save_model_path\n     else:\n-      save_model_path = tempfile.mktemp(suffix='.saved_model')\n+      save_model_path = tempfile.mkstemp(suffix='.saved_model')\n \n     signature_def_map, init_op, assets_collection = create_signature()\n \n",
          "changes": [
            {
              "lineNumber": "91",
              "description": "Replaces `tempfile.mktemp` with `tempfile.mkstemp`.",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:python/sql-parameterization",
      "summary": "Parameterize SQL Queries",
      "description": "This codemod refactors SQL statements to be parameterized, rather than built by hand.\n\nWithout parameterization, developers must remember to escape string inputs using the rules for that column type and database. This usually results in bugs -- and sometimes vulnerabilities. Although we can't tell for sure if your code is actually exploitable, this change will make the code more robust in case the conditions which prevent exploitation today ever go away.\n\nOur changes look something like this:\n\n```diff\nimport sqlite3\n\nname = input()\nconnection = sqlite3.connect(\"my_db.db\")\ncursor = connection.cursor()\n- cursor.execute(\"SELECT * from USERS WHERE name ='\" + name + \"'\")\n+ cursor.execute(\"SELECT * from USERS WHERE name =?\", (name, ))\n```\n",
      "references": [
        {
          "url": "https://cwe.mitre.org/data/definitions/89.html",
          "description": "https://cwe.mitre.org/data/definitions/89.html"
        },
        {
          "url": "https://owasp.org/www-community/attacks/SQL_Injection",
          "description": "https://owasp.org/www-community/attacks/SQL_Injection"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/str-concat-in-sequence-literals",
      "summary": "Convert Implicit String Concat Inside Sequence into Individual Elements",
      "description": "This codemod fixes cases of implicit string concatenation inside lists, sets, or tuples. This is most likely a mistake: you probably meant include a comma in between the concatenated strings. \n\nOur changes look something like this:\n```diff\nbad = [\n-    \"ab\"\n+    \"ab\",\n     \"cd\",\n     \"ef\",\n-    \"gh\"\n+    \"gh\",\n     \"ij\",\n]\n```\n",
      "references": [],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/subprocess-shell-false",
      "summary": "Use `shell=False` in `subprocess` Function Calls",
      "description": "This codemod sets the `shell` keyword argument to `False` in `subprocess` module function calls that have set it to `True`.\n\nSetting `shell=True` will execute the provided command through the system shell which can lead to shell injection vulnerabilities. In the worst case this can give an attacker the ability to run arbitrary commands on your system. In most cases using `shell=False` is sufficient and leads to much safer code.\n\nThe changes from this codemod look like this:\n\n```diff\n import subprocess\n- subprocess.run(\"echo 'hi'\", shell=True)\n+ subprocess.run(\"echo 'hi'\", shell=False)\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/subprocess.html#security-considerations",
          "description": "https://docs.python.org/3/library/subprocess.html#security-considerations"
        },
        {
          "url": "https://en.wikipedia.org/wiki/Code_injection#Shell_injection",
          "description": "https://en.wikipedia.org/wiki/Code_injection#Shell_injection"
        },
        {
          "url": "https://stackoverflow.com/a/3172488",
          "description": "https://stackoverflow.com/a/3172488"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/upgrade-sslcontext-minimum-version",
      "summary": "Upgrade SSLContext Minimum Version",
      "description": "This codemod replaces all unsafe and/or deprecated SSL/TLS versions when used\nto set the `ssl.SSLContext.minimum_version` attribute. It uses\n`ssl.TLSVersion.TLSv1_2` instead, which ensures a safe default minimum TLS\nversion.\n\nOur change involves modifying the `minimum_version` attribute of\n`ssl.SSLContext` instances to use `ssl.TLSVersion.TLSv1_2`.\n\n```diff\n  import ssl\n  context = ssl.SSLContext(protocol=PROTOCOL_TLS_CLIENT)\n- context.minimum_version = ssl.TLSVersion.SSLv3\n+ context.minimum_version = ssl.TLSVersion.TLSv1_2\n```\n\nThere is no functional difference between the unsafe and safe versions, and all modern servers offer TLSv1.2.\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/ssl.html#security-considerations",
          "description": "https://docs.python.org/3/library/ssl.html#security-considerations"
        },
        {
          "url": "https://datatracker.ietf.org/doc/rfc8996/",
          "description": "https://datatracker.ietf.org/doc/rfc8996/"
        },
        {
          "url": "https://www.digicert.com/blog/depreciating-tls-1-0-and-1-1",
          "description": "https://www.digicert.com/blog/depreciating-tls-1-0-and-1-1"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/upgrade-sslcontext-tls",
      "summary": "Upgrade TLS Version In SSLContext",
      "description": "This codemod replaces the use of all unsafe and/or deprecated SSL/TLS versions\nin the `ssl.SSLContext` constructor. It uses `PROTOCOL_TLS_CLIENT` instead,\nwhich ensures a safe default TLS version. It also sets the `protocol` parameter\nto `PROTOCOL_TLS_CLIENT` in calls without it, which is now deprecated.\n\nOur change involves modifying the argument to `ssl.SSLContext()` to\nuse `PROTOCOL_TLS_CLIENT`.\n\n```diff\n  import ssl\n- context = ssl.SSLContext()  \n+ context = ssl.SSLContext(protocol=PROTOCOL_TLS_CLIENT)\n- context = ssl.SSLContext(protocol=PROTOCOL_SSLv3)\n+ context = ssl.SSLContext(protocol=PROTOCOL_TLS_CLIENT)\n```\n\nThere is no functional difference between the unsafe and safe versions, and all modern servers offer TLSv1.2.\n\nThe use of explicit TLS versions (even safe ones) is deprecated by the `ssl`\nmodule, so it is necessary to choose either `PROTOCOL_TLS_CLIENT` or\n`PROTOCOL_TLS_SERVER`. Using `PROTOCOL_TLS_CLIENT` is expected to be the\ncorrect choice for most applications but in some cases it will be necessary to\nuse `PROTOCOL_TLS_SERVER` instead.\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/ssl.html#security-considerations",
          "description": "https://docs.python.org/3/library/ssl.html#security-considerations"
        },
        {
          "url": "https://datatracker.ietf.org/doc/rfc8996/",
          "description": "https://datatracker.ietf.org/doc/rfc8996/"
        },
        {
          "url": "https://www.digicert.com/blog/depreciating-tls-1-0-and-1-1",
          "description": "https://www.digicert.com/blog/depreciating-tls-1-0-and-1-1"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/url-sandbox",
      "summary": "Sandbox URL Creation",
      "description": "This codemod sandboxes calls to [`requests.get`](https://requests.readthedocs.io/en/latest/api/#requests.get) to be more resistant to Server-Side Request Forgery (SSRF) attacks.\n\nMost of the time when you make a `GET` request to a URL, you're intending to reference an HTTP endpoint, like an internal microservice. However, URLs can point to local file system files, a Gopher stream in your local network, a JAR file on a remote Internet site, and all kinds of other unexpected and undesirable outcomes. When the URL values are influenced by attackers, they can trick your application into fetching internal resources, running malicious code, or otherwise harming the system.\nConsider the following code for a Flask app:\n\n```python\nfrom flask import Flask, request\nimport requests\n\napp = Flask(__name__)\n\n@app.route(\"/request-url\")\ndef request_url():\n    url = request.args[\"loc\"]\n    resp = requests.get(url)\n    ...\n```\n\nIn this case, an attacker could supply a value like `\"http://169.254.169.254/user-data/\"` and attempt to access user information.\n\nOur changes introduce sandboxing around URL creation that force developers to specify some boundaries on the types of URLs they expect to create:\n\n```diff\n  from flask import Flask, request\n- import requests\n+ from security import safe_requests\n\n  app = Flask(__name__)\n\n  @app.route(\"/request-url\")\n  def request_url():\n    url = request.args[\"loc\"]\n-   resp = requests.get(url)\n+   resp = safe_requests.get(url)\n    ...\n```\n\nThis change alone reduces attack surface significantly because the default behavior of `safe_requests.get` raises a `SecurityException` if\na user attempts to access a known infrastructure location, unless specifically disabled.\n\n\nIf you have feedback on this codemod, [please let us know](mailto:feedback@pixee.ai)!\n\n## F.A.Q. \n\n### Why does this codemod require a Pixee dependency?\n\nWe always prefer to use built-in Python functions or one from a well-known and trusted community dependency. However, we cannot find any such control. If you know of one, [please let us know](https://ask.pixee.ai/feedback).\n\n### Why is this codemod marked as Merge After Cursory Review?\n\nBy default, the protection only weaves in 2 checks, which we believe will not cause any issues with the vast majority of code:\n1. The given URL must be HTTP/HTTPS.\n2. The given URL must not point to a \"well-known infrastructure target\", which includes things like AWS Metadata Service endpoints, and internal routers (e.g., 192.168.1.1) which are common targets of attacks.\n\nHowever, on rare occasions an application may use a URL protocol like \"file://\" or \"ftp://\" in backend or middleware code.\n\nIf you want to allow those protocols, change the incoming PR to look more like this and get the best security possible:\n\n```diff\n-resp = requests.get(url)\n+resp = safe_requests.get(url, allowed_protocols=(\"ftp\",))\n```\n\n## Dependency Updates\n\nThis codemod relies on an external dependency. However, we were unable to automatically add the dependency to your project. \n\nThis library holds security tools for protecting Python API calls. \n\nThere are a number of places where Python project dependencies can be expressed, including `setup.py`, `pyproject.toml`, `setup.cfg`, and `requirements.txt` files. You may need to manually add this dependency to the proper location in your project.\n\n### Manual Installation\n\nFor `setup.py`:\n```diff\n install_requires=[\n+    \"security~=1.2.0\",\n ],\n```\n\nFor `pyproject.toml` (using `setuptools`):\n```diff\n [project]\n dependencies = [\n+    \"security~=1.2.0\",\n ]\n```\n\nFor `setup.cfg`:\n```diff\n [options]\n install_requires =\n+    security~=1.2.0\n```\n\nFor `requirements.txt`:\n```diff\n+security~=1.2.0\n```\n\nFor more information on adding dependencies to `setuptools` projects, see [the setuptools documentation](https://setuptools.pypa.io/en/latest/userguide/dependency_management.html#declaring-required-dependency). \n\nIf you are using another build system, please refer to the documentation for that system to determine how to add dependencies.\n",
      "references": [
        {
          "url": "https://github.com/pixee/python-security/blob/main/src/security/safe_requests/api.py",
          "description": "https://github.com/pixee/python-security/blob/main/src/security/safe_requests/api.py"
        },
        {
          "url": "https://portswigger.net/web-security/ssrf",
          "description": "https://portswigger.net/web-security/ssrf"
        },
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html"
        },
        {
          "url": "https://www.rapid7.com/blog/post/2021/11/23/owasp-top-10-deep-dive-defending-against-server-side-request-forgery/",
          "description": "https://www.rapid7.com/blog/post/2021/11/23/owasp-top-10-deep-dive-defending-against-server-side-request-forgery/"
        },
        {
          "url": "https://blog.assetnote.io/2021/01/13/blind-ssrf-chains/",
          "description": "https://blog.assetnote.io/2021/01/13/blind-ssrf-chains/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": [
        {
          "path": "tensorflow/python/distribute/failure_handling/failure_handling_util.py",
          "diff": "--- \n+++ \n@@ -21,6 +21,7 @@\n from six.moves.urllib import request\n from tensorflow.python.eager import context\n from tensorflow.python.platform import tf_logging as logging\n+from security import safe_requests\n \n \n GCP_METADATA_HEADER = {'Metadata-Flavor': 'Google'}\n@@ -79,8 +80,7 @@\n   try:\n     # Timeout in 5 seconds, in case the test environment has connectivity issue.\n     # There is not default timeout, which means it might block forever.\n-    response = requests.get(\n-        '%s/computeMetadata/v1/%s' %\n+    response = safe_requests.get('%s/computeMetadata/v1/%s' %\n         (gce_metadata_endpoint, 'instance/hostname'),\n         headers=GCP_METADATA_HEADER,\n         timeout=5)\n",
          "changes": [
            {
              "lineNumber": "82",
              "description": "Switch use of requests for security.safe_requests",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        },
        {
          "path": "tensorflow/python/tools/grpc_tpu_worker.py",
          "diff": "--- \n+++ \n@@ -34,11 +34,11 @@\n from tensorflow.core.protobuf import config_pb2\n from tensorflow.core.protobuf import tensorflow_server_pb2\n from tensorflow.python.training import server_lib\n+from security import safe_requests\n \n \n def get_metadata(key):\n-  return requests.get(\n-      'http://metadata.google.internal/computeMetadata'\n+  return safe_requests.get('http://metadata.google.internal/computeMetadata'\n       '/v1/instance/attributes/{}'.format(key),\n       headers={\n           'Metadata-Flavor': 'Google'\n",
          "changes": [
            {
              "lineNumber": "40",
              "description": "Switch use of requests for security.safe_requests",
              "properties": {},
              "diffSide": "right",
              "packageActions": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:python/use-defusedxml",
      "summary": "Use `defusedxml` for Parsing XML",
      "description": "You might be surprised to learn that Python's built-in XML libraries are [considered insecure](https://docs.python.org/3/library/xml.html#xml-vulnerabilities) against various kinds of attacks.\n\nIn fact, the [Python documentation itself](https://docs.python.org/3/library/xml.html#the-defusedxml-package) recommends the use of [defusedxml](https://pypi.org/project/defusedxml/) for parsing untrusted XML data. `defusedxml` is an [open-source](https://github.com/tiran/defusedxml), permissively licensed project that is intended as a drop-in replacement for Python's standard library XML parsers.\n\nThis codemod updates all relevant uses of the standard library parsers with safe versions from `defusedxml`. It also adds the `defusedxml` dependency to your project where possible.\n\nThe changes from this codemod look like this:\n```diff\n- from xml.etree.ElementTree import parse\n+ import defusedxml.ElementTree\n\n- et = parse('data.xml')\n+ et = defusedxml.ElementTree.parse('data.xml')\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/xml.html#xml-vulnerabilities",
          "description": "https://docs.python.org/3/library/xml.html#xml-vulnerabilities"
        },
        {
          "url": "https://docs.python.org/3/library/xml.html#the-defusedxml-package",
          "description": "https://docs.python.org/3/library/xml.html#the-defusedxml-package"
        },
        {
          "url": "https://pypi.org/project/defusedxml/",
          "description": "https://pypi.org/project/defusedxml/"
        },
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/use-generator",
      "summary": "Use Generator Expressions Instead of List Comprehensions",
      "description": "Imagine that someone handed you a pile of 100 apples and then asked you to count how many of them were green without putting any of them down. You'd probably find this quite challenging and you'd struggle to hold the pile of apples at all. Now imagine someone handed you the apples one at a time and asked you to just count the green ones. This would be a much easier task.\n\nIn Python, when we use list comprehensions, it's like we've created the entire pile of apples and asked the interpreter to hold onto it. Sometimes, a better practice involves using generator expressions, which create iterators that yield objects one at a time. For large data sets, this can turn a slow, memory intensive operation into a relatively fast one.\n\nUsing generator expressions instead of list comprehensions can lead to better performance. This is especially true for functions such as `any` where it's not always necessary to evaluate the entire list before returning. For other functions such as `max` or `sum` it means that the program does not need to store the entire list in memory. These performance effects becomes more noticeable as the sizes of the lists involved grow large.\n\nThis codemod replaces the use of a list comprehension expression with a generator expression within certain function calls. Generators allow for lazy evaluation of the iterator, which can have performance benefits.\n\nThe changes from this codemod look like this:\n```diff\n- result = sum([x for x in range(1000)])\n+ result = sum(x for x in range(1000))\n```\n",
      "references": [
        {
          "url": "https://pylint.readthedocs.io/en/latest/user_guide/messages/refactor/use-a-generator.html",
          "description": "https://pylint.readthedocs.io/en/latest/user_guide/messages/refactor/use-a-generator.html"
        },
        {
          "url": "https://docs.python.org/3/glossary.html#term-generator-expression",
          "description": "https://docs.python.org/3/glossary.html#term-generator-expression"
        },
        {
          "url": "https://docs.python.org/3/glossary.html#term-list-comprehension",
          "description": "https://docs.python.org/3/glossary.html#term-list-comprehension"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/use-set-literal",
      "summary": "Use Set Literals Instead of Sets from Lists",
      "description": "This codemod converts Python set constructions using literal list arguments into more efficient and readable set literals. It simplifies expressions like `set([1, 2, 3])` to `{1, 2, 3}`, enhancing both performance and code clarity.\n\nOur changes look like this:\n```diff\n-x = set([1, 2, 3])\n+x = {1, 2, 3}\n```\n",
      "references": [],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:python/use-walrus-if",
      "summary": "Use Assignment Expression (Walrus) In Conditional",
      "description": "This codemod updates places where two separate statements involving an assignment and conditional can be replaced with a single Assignment Expression (commonly known as the walrus operator).\n\nMany developers use this operator in new code that they write but don't have the time to find and update every place in existing code. So we do it for you! We believe this leads to more concise and readable code.\n\nThe changes from this codemod look like this:\n\n```diff\n- x = foo()\n- if x is not None:\n+ if (x := foo()) is not None:\n      print(x)\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/whatsnew/3.8.html#assignment-expressions",
          "description": "https://docs.python.org/3/whatsnew/3.8.html#assignment-expressions"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "sonar:python/django-json-response-type-S5131",
      "summary": "Sonar: Set content type to `application/json` for `django.http.HttpResponse` with JSON data",
      "description": "This codemod acts upon the following Sonar rules: 'pythonsecurity:S5131'.\n\nThe default `content_type` for `HttpResponse` in Django is `'text/html'`. This is true even when the response contains JSON data.\nIf the JSON contains (unsanitized) user-supplied input, a malicious user may supply HTML code which leaves the application vulnerable to cross-site scripting (XSS). \nThis fix explicitly sets the response type to `application/json` when the response body is JSON data to avoid this vulnerability. Our changes look something like this:\n\n```diff\nfrom django.http import HttpResponse\nimport json\n\ndef foo(request):\n    json_response = json.dumps({ \"user_input\": request.GET.get(\"input\") })\n-    return HttpResponse(json_response)\n+    return HttpResponse(json_response, content_type=\"application/json\")\n```\n",
      "references": [
        {
          "url": "https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpResponse.__init__",
          "description": "https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpResponse.__init__"
        },
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html#output-encoding-for-javascript-contexts",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html#output-encoding-for-javascript-contexts"
        },
        {
          "url": "https://rules.sonarsource.com/python/type/Bug/RSPEC-5131/",
          "description": "https://rules.sonarsource.com/python/type/Bug/RSPEC-5131/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "sonar:python/django-receiver-on-top-S6552",
      "summary": "Sonar: Ensure Django @receiver is the first decorator",
      "description": "This codemod acts upon the following Sonar rules: 'python:S6552'.\n\nDjango uses signals to notify and handle actions that happens elsewhere in the application. You can define a response to a given signal by decorating a function with the `@receiver(signal)` decorator. The order in which the decorators are declared for this function is important. If the `@receiver` decorator is not on top, any decorators before it will be ignored. \nOur changes look something like this:\n\n```diff\nfrom django.dispatch import receiver\nfrom django.views.decorators.csrf import csrf_exempt\nfrom django.core.signals import request_finished\n\n+@receiver(request_finished)\n@csrf_exempt\n-@receiver(request_finished)\ndef foo():\n    pass\n```\n",
      "references": [
        {
          "url": "https://docs.djangoproject.com/en/4.1/topics/signals/",
          "description": "https://docs.djangoproject.com/en/4.1/topics/signals/"
        },
        {
          "url": "https://rules.sonarsource.com/python/type/Bug/RSPEC-6552/",
          "description": "https://rules.sonarsource.com/python/type/Bug/RSPEC-6552/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "sonar:python/exception-without-raise-S3984",
      "summary": "Sonar: Ensure bare exception statements are raised",
      "description": "This codemod acts upon the following Sonar rules: 'python:S3984'.\n\nThis codemod fixes cases where an exception is referenced by itself in a statement without being raised. This most likely indicates a bug: you probably meant to actually raise the exception. \n\nOur changes look something like this:\n```diff\ntry:\n-   ValueError\n+   raise ValueError\nexcept:\n    pass\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/tutorial/errors.html#raising-exceptions",
          "description": "https://docs.python.org/3/tutorial/errors.html#raising-exceptions"
        },
        {
          "url": "https://rules.sonarsource.com/python/type/Bug/RSPEC-3984/",
          "description": "https://rules.sonarsource.com/python/type/Bug/RSPEC-3984/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "sonar:python/fix-assert-tuple-S5905",
      "summary": "Sonar: Fix `assert` on Non-Empty Tuple Literal",
      "description": "This codemod acts upon the following Sonar rules: 'python:S5905'.\n\nAn assertion on a non-empty tuple will always evaluate to `True`. This means that `assert` statements involving non-empty tuple literals are likely unintentional and should be rewritten. This codemod rewrites the original `assert` statement by creating a new `assert` for each item in the original tuple.\n\nThe changes from this codemod look like this:\n\n```diff\n- assert (1 == 1, 2 == 2)\n+ assert 1 == 1\n+ assert 2 == 2\n```\n",
      "references": [
        {
          "url": "https://rules.sonarsource.com/python/type/Bug/RSPEC-5905/",
          "description": "https://rules.sonarsource.com/python/type/Bug/RSPEC-5905/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "sonar:python/flask-json-response-type-S5131",
      "summary": "Sonar: Set content type to `application/json` for `flask.make_response` with JSON data",
      "description": "This codemod acts upon the following Sonar rules: 'pythonsecurity:S5131'.\n\nThe default `mimetype` for `make_response` in Flask is `'text/html'`. This is true even when the response contains JSON data.\nIf the JSON contains (unsanitized) user-supplied input, a malicious user may supply HTML code which leaves the application vulnerable to cross-site scripting (XSS). \nThis fix explicitly sets the response type to `application/json` when the response body is JSON data to avoid this vulnerability. Our changes look something like this:\n\n```diff\nfrom flask import make_response, Flask\nimport json\n\napp = Flask(__name__)\n\n@app.route(\"/test\")\ndef foo(request):\n    json_response = json.dumps({ \"user_input\": request.GET.get(\"input\") })\n-   return make_response(json_response)\n+   return make_response(json_response, {'Content-Type':'application/json'})\n```\n",
      "references": [
        {
          "url": "https://flask.palletsprojects.com/en/2.3.x/patterns/javascript/#return-json-from-views",
          "description": "https://flask.palletsprojects.com/en/2.3.x/patterns/javascript/#return-json-from-views"
        },
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html#output-encoding-for-javascript-contexts",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html#output-encoding-for-javascript-contexts"
        },
        {
          "url": "https://rules.sonarsource.com/python/type/Bug/RSPEC-5131/",
          "description": "https://rules.sonarsource.com/python/type/Bug/RSPEC-5131/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "sonar:python/literal-or-new-object-identity-S5796",
      "summary": "Sonar: Replace `is` with `==` for literal or new object comparisons",
      "description": "This codemod acts upon the following Sonar rules: 'python:S5796'.\n\nThe `is` and `is not` operators only evaluate to `True` when the expressions on each side have the same `id`. In other words, `a is b` is equivalent to `id(a) == id(b)`. With few exceptions, objects and literals have unique identities and thus shouldn't generally be compared by using the `is` or `is not` operators.\n\nOur changes look something like this:\n\n```diff\ndef foo(l):\n-    return l is [1,2,3]\n+    return l == [1,2,3]\n```\n",
      "references": [
        {
          "url": "https://docs.python.org/3/library/stdtypes.html#comparisons",
          "description": "https://docs.python.org/3/library/stdtypes.html#comparisons"
        },
        {
          "url": "https://rules.sonarsource.com/python/type/Bug/RSPEC-5796/",
          "description": "https://rules.sonarsource.com/python/type/Bug/RSPEC-5796/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "sonar:python/numpy-nan-equality-S6725",
      "summary": "Sonar: Replace == comparison with numpy.isnan()",
      "description": "This codemod acts upon the following Sonar rules: 'python:S6725'.\n\nComparisons against `numpy.nan` always result in `False`. Thus comparing an expression directly against `numpy.nan` is always unintended. The correct way to compare a value for `NaN` is to use the `numpy.isnan` function.\n\nOur changes look something like this:\n\n```diff\nimport numpy as np\n\na = np.nan\n-if a == np.nan:\n+if np.isnan(a):\n    pass\n```\n",
      "references": [
        {
          "url": "https://numpy.org/doc/stable/reference/constants.html#numpy.nan",
          "description": "https://numpy.org/doc/stable/reference/constants.html#numpy.nan"
        },
        {
          "url": "https://rules.sonarsource.com/python/type/Bug/RSPEC-6725/",
          "description": "https://rules.sonarsource.com/python/type/Bug/RSPEC-6725/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "sonar:python/remove-assertion-in-pytest-raises-S5915",
      "summary": "Sonar: Moves assertions out of `pytest.raises` scope",
      "description": "This codemod acts upon the following Sonar rules: 'python:S5915'.\n\nThe context manager object `pytest.raises(<exception>)` will assert if the code contained within its scope will raise an exception of type `<exception>`. The documentation points that the exception must be raised in the last line of its scope and any line afterwards won't be executed. \nIncluding asserts at the end of the scope is a common error. This codemod addresses that by moving them out of the scope.\nOur changes look something like this:\n\n```diff\nimport pytest\n\ndef test_foo():\n    with pytest.raises(ZeroDivisionError):\n        error = 1/0\n-       assert 1\n-       assert 2\n+   assert 1\n+   assert 2\n```\n",
      "references": [
        {
          "url": "https://docs.pytest.org/en/7.4.x/reference/reference.html#pytest-raises",
          "description": "https://docs.pytest.org/en/7.4.x/reference/reference.html#pytest-raises"
        },
        {
          "url": "https://rules.sonarsource.com/python/type/Bug/RSPEC-5915/",
          "description": "https://rules.sonarsource.com/python/type/Bug/RSPEC-5915/"
        }
      ],
      "properties": {},
      "failedFiles": [],
      "changeset": []
    },
    {
      "codemod": "pixee:java/harden-process-creation",
      "summary": "Introduced protections against system command injection",
      "description": "This change hardens all instances of [Runtime#exec()](https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Runtime.html) to offer protection against attack.\n\nLeft unchecked, `Runtime#exec()` can execute any arbitrary system command. If an attacker can control part of the strings used to as program paths or arguments, they could execute arbitrary programs, install malware, and anything else they could do if they had a shell open on the application host.\n\nOur change introduces a sandbox which protects the application:\n\n```diff\n+ import io.github.pixee.security.SystemCommand;\n  ...\n- Process p = Runtime.getRuntime().exec(command);\n+ Process p = SystemCommand.runCommand(Runtime.getRuntime(), command);\n```\n\nThe default restrictions applied are the following:\n* **Prevent command chaining**. Many exploits work by injecting command separators and causing the shell to interpret a second, malicious command. The `SystemCommand#runCommand()` attempts to parse the given command, and throw a `SecurityException` if multiple commands are present.\n* **Prevent arguments targeting sensitive files.** There is little reason for custom code to target sensitive system files like `/etc/passwd`, so the sandbox prevents arguments that point to these files that may be targets for exfiltration.\n\nThere are [more options for sandboxing](https://github.com/pixee/java-security-toolkit/blob/main/src/main/java/io/github/pixee/security/SystemCommand.java#L15) if you are interested in locking down system commands even more.\n",
      "failedFiles": [],
      "references": [
        {
          "url": "https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html",
          "description": "https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html"
        },
        {
          "url": "https://wiki.sei.cmu.edu/confluence/display/java/IDS07-J.+Sanitize+untrusted+data+passed+to+the+Runtime.exec%28%29+method",
          "description": "https://wiki.sei.cmu.edu/confluence/display/java/IDS07-J.+Sanitize+untrusted+data+passed+to+the+Runtime.exec%28%29+method"
        }
      ],
      "properties": {},
      "changeset": [
        {
          "path": "tensorflow/lite/java/ovic/demo/app/OvicBenchmarkerActivity.java",
          "diff": "--- OvicBenchmarkerActivity.java\n+++ OvicBenchmarkerActivity.java\n@@ -25,6 +25,7 @@\n import android.util.Log;\n import android.view.View;\n import android.widget.TextView;\n+import io.github.pixee.security.SystemCommand;\n import java.io.BufferedReader;\n import java.io.File;\n import java.io.FileInputStream;\n@@ -215,7 +216,7 @@\n     String command = String.format(\"taskset -a -p %x %d\", mask, myPid);\n     try {\n       // TODO(b/153429929) This is deprecated, but updating is not safe while verification is hard.\n-      Runtime.getRuntime().exec(command).waitFor();\n+      SystemCommand.runCommand(Runtime.getRuntime(), command).waitFor();\n     } catch (InterruptedException e) {\n       throw new IOException(\"Interrupted: \" + e);\n     }",
          "changes": [
            {
              "lineNumber": 218,
              "properties": {},
              "description": "Hardened this system call to make it resistant to injected commands and commands that target sensitive files",
              "diffSide": "left",
              "packageActions": [
                {
                  "action": "ADD",
                  "result": "FAILED",
                  "package": "pkg:maven/io.github.pixee/java-security-toolkit@1.1.2"
                }
              ],
              "parameters": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:java/limit-readline",
      "summary": "Protect `readLine()` against DoS",
      "description": "This change hardens all [`BufferedReader#readLine()`](https://docs.oracle.com/javase/8/docs/api/java/io/BufferedReader.html#readLine--) operations against memory exhaustion.\n\nThere is no way to call `readLine()` safely since it is, by its nature, a read that must be terminated by the stream provider. Furthermore, a stream of data provided by an untrusted source could lead to a denial of service attack, as attackers can provide an infinite stream of bytes until the process runs out of memory.\n\nFixing it is straightforward using an API which limits the amount of expected characters to some sane limit. This is what our changes look like:\n\n```diff\n+ import io.github.pixee.security.BoundedLineReader;\n  ...\n  BufferedReader reader = getReader();\n- String line = reader.readLine(); // unlimited read, can lead to DoS\n+ String line = BoundedLineReader.readLine(reader, 5_000_000); // limited to 5MB\n```\n",
      "failedFiles": [],
      "references": [
        {
          "url": "https://vulncat.fortify.com/en/detail?id=desc.dataflow.abap.denial_of_service",
          "description": "https://vulncat.fortify.com/en/detail?id=desc.dataflow.abap.denial_of_service"
        },
        {
          "url": "https://cwe.mitre.org/data/definitions/400.html",
          "description": "https://cwe.mitre.org/data/definitions/400.html"
        }
      ],
      "properties": {},
      "changeset": [
        {
          "path": "tensorflow/lite/java/demo/app/src/main/java/com/example/android/tflitecamerademo/ImageClassifier.java",
          "diff": "--- ImageClassifier.java\n+++ ImageClassifier.java\n@@ -24,6 +24,7 @@\n import android.text.style.ForegroundColorSpan;\n import android.text.style.RelativeSizeSpan;\n import android.util.Log;\n+import io.github.pixee.security.BoundedLineReader;\n import java.io.BufferedReader;\n import java.io.FileInputStream;\n import java.io.IOException;\n@@ -217,7 +218,7 @@\n     BufferedReader reader =\n         new BufferedReader(new InputStreamReader(activity.getAssets().open(getLabelPath())));\n     String line;\n-    while ((line = reader.readLine()) != null) {\n+    while ((line = BoundedLineReader.readLine(reader, 5_000_000)) != null) {\n       labelList.add(line);\n     }\n     reader.close();",
          "changes": [
            {
              "lineNumber": 220,
              "properties": {},
              "description": "Replaced with a call that offers an upper bound on the number of characters that will be read before giving up and throwing a security exception",
              "diffSide": "left",
              "packageActions": [
                {
                  "action": "ADD",
                  "result": "FAILED",
                  "package": "pkg:maven/io.github.pixee/java-security-toolkit@1.1.2"
                }
              ],
              "parameters": []
            }
          ]
        },
        {
          "path": "tensorflow/lite/java/ovic/demo/app/OvicBenchmarkerActivity.java",
          "diff": "--- OvicBenchmarkerActivity.java\n+++ OvicBenchmarkerActivity.java\n@@ -25,6 +25,7 @@\n import android.util.Log;\n import android.view.View;\n import android.widget.TextView;\n+import io.github.pixee.security.BoundedLineReader;\n import io.github.pixee.security.SystemCommand;\n import java.io.BufferedReader;\n import java.io.File;\n@@ -256,10 +257,10 @@\n     BufferedReader bufReader = null;\n     try {\n       bufReader = new BufferedReader(new FileReader(file));\n-      while ((line = bufReader.readLine()) != null) {\n+      while ((line = BoundedLineReader.readLine(bufReader, 5_000_000)) != null) {\n         if (line.startsWith(resultPrefix)) {\n           allowedMask = Integer.valueOf(line.substring(resultPrefix.length()).trim(), 16);\n-          allowedCPU = bufReader.readLine();\n+          allowedCPU = BoundedLineReader.readLine(bufReader, 5_000_000);\n           break;\n         }\n       }",
          "changes": [
            {
              "lineNumber": 259,
              "properties": {},
              "description": "Replaced with a call that offers an upper bound on the number of characters that will be read before giving up and throwing a security exception",
              "diffSide": "left",
              "packageActions": [
                {
                  "action": "ADD",
                  "result": "FAILED",
                  "package": "pkg:maven/io.github.pixee/java-security-toolkit@1.1.2"
                }
              ],
              "parameters": []
            },
            {
              "lineNumber": 262,
              "properties": {},
              "description": "Replaced with a call that offers an upper bound on the number of characters that will be read before giving up and throwing a security exception",
              "diffSide": "left",
              "packageActions": [
                {
                  "action": "ADD",
                  "result": "FAILED",
                  "package": "pkg:maven/io.github.pixee/java-security-toolkit@1.1.2"
                }
              ],
              "parameters": []
            }
          ]
        },
        {
          "path": "tensorflow/lite/java/ovic/src/main/java/org/tensorflow/ovic/OvicClassifier.java",
          "diff": "--- OvicClassifier.java\n+++ OvicClassifier.java\n@@ -14,6 +14,7 @@\n ==============================================================================*/\n package org.tensorflow.ovic;\n \n+import io.github.pixee.security.BoundedLineReader;\n import static java.nio.charset.StandardCharsets.UTF_8;\n \n import java.io.BufferedReader;\n@@ -182,7 +183,7 @@\n     try (BufferedReader reader =\n         new BufferedReader(new InputStreamReader(labelInputStream, UTF_8))) {\n       String line;\n-      while ((line = reader.readLine()) != null) {\n+      while ((line = BoundedLineReader.readLine(reader, 5_000_000)) != null) {\n         labelList.add(line);\n       }\n     }",
          "changes": [
            {
              "lineNumber": 185,
              "properties": {},
              "description": "Replaced with a call that offers an upper bound on the number of characters that will be read before giving up and throwing a security exception",
              "diffSide": "left",
              "packageActions": [
                {
                  "action": "ADD",
                  "result": "FAILED",
                  "package": "pkg:maven/io.github.pixee/java-security-toolkit@1.1.2"
                }
              ],
              "parameters": []
            }
          ]
        },
        {
          "path": "tensorflow/lite/java/ovic/src/main/java/org/tensorflow/ovic/OvicDetector.java",
          "diff": "--- OvicDetector.java\n+++ OvicDetector.java\n@@ -14,6 +14,7 @@\n ==============================================================================*/\n package org.tensorflow.ovic;\n \n+import io.github.pixee.security.BoundedLineReader;\n import static java.nio.charset.StandardCharsets.UTF_8;\n \n import java.io.BufferedReader;\n@@ -108,7 +109,7 @@\n     try (BufferedReader reader =\n         new BufferedReader(new InputStreamReader(labelInputStream, UTF_8))) {\n       String line;\n-      while ((line = reader.readLine()) != null) {\n+      while ((line = BoundedLineReader.readLine(reader, 5_000_000)) != null) {\n         labelList.add(line);\n       }\n     }",
          "changes": [
            {
              "lineNumber": 111,
              "properties": {},
              "description": "Replaced with a call that offers an upper bound on the number of characters that will be read before giving up and throwing a security exception",
              "diffSide": "left",
              "packageActions": [
                {
                  "action": "ADD",
                  "result": "FAILED",
                  "package": "pkg:maven/io.github.pixee/java-security-toolkit@1.1.2"
                }
              ],
              "parameters": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:java/switch-literal-first",
      "summary": "Switch order of literals to prevent NullPointerException",
      "description": "This change defensively switches the order of literals in comparison expressions to ensure that no null pointer exceptions are unexpectedly thrown. Runtime exceptions especially can cause exceptional and unexpected code paths to be taken, and this can result in unexpected behavior. \n\nBoth simple vulnerabilities (like information disclosure) and complex vulnerabilities (like business logic flaws) can take advantage of these unexpected code paths.\n\nOur changes look something like this:\n\n```diff\n  String fieldName = header.getFieldName();\n  String fieldValue = header.getFieldValue();\n- if(fieldName.equals(\"requestId\")) {\n+ if(\"requestId\".equals(fieldName)) {\n    logRequest(fieldValue);\n  }\n```\n",
      "failedFiles": [],
      "references": [
        {
          "url": "https://cwe.mitre.org/data/definitions/476.html",
          "description": "https://cwe.mitre.org/data/definitions/476.html"
        },
        {
          "url": "https://en.wikibooks.org/wiki/Java_Programming/Preventing_NullPointerException",
          "description": "https://en.wikibooks.org/wiki/Java_Programming/Preventing_NullPointerException"
        },
        {
          "url": "https://rules.sonarsource.com/java/RSPEC-1132/",
          "description": "https://rules.sonarsource.com/java/RSPEC-1132/"
        }
      ],
      "properties": {},
      "changeset": [
        {
          "path": "tensorflow/java/src/main/java/org/tensorflow/Tensor.java",
          "diff": "--- Tensor.java\n+++ Tensor.java\n@@ -600,7 +600,7 @@\n   }\n \n   private static void throwExceptionIfNotByteOfByteArrays(Object array) {\n-    if (!array.getClass().getName().equals(\"[[B\")) {\n+    if (!\"[[B\".equals(array.getClass().getName())) {\n       throw new IllegalArgumentException(\n           \"object cannot be converted to a Tensor as it includes an array with null elements\");\n     }",
          "changes": [
            {
              "lineNumber": 603,
              "properties": {},
              "description": "Switch order of literals to prevent NullPointerException",
              "diffSide": "left",
              "packageActions": [],
              "parameters": []
            }
          ]
        },
        {
          "path": "tensorflow/lite/java/ovic/src/main/java/org/tensorflow/ovic/OvicValidator.java",
          "diff": "--- OvicValidator.java\n+++ OvicValidator.java\n@@ -44,7 +44,7 @@\n     }\n     final String modelFile = args[0];\n     final String taskString = args[1];\n-    final boolean isDetection = taskString.equals(\"detect\");\n+    final boolean isDetection = \"detect\".equals(taskString);\n     // Label file for detection is never used, so the same label file is used for both tasks.\n     final String labelPath =\n         \"tensorflow/lite/java/ovic/src/testdata/labels.txt\";",
          "changes": [
            {
              "lineNumber": 47,
              "properties": {},
              "description": "Switch order of literals to prevent NullPointerException",
              "diffSide": "left",
              "packageActions": [],
              "parameters": []
            }
          ]
        },
        {
          "path": "tensorflow/lite/tools/benchmark/experimental/delegate_performance/android/src/main/java/org/tensorflow/lite/benchmark/delegateperformance/ModelBenchmarkReport.java",
          "diff": "--- ModelBenchmarkReport.java\n+++ ModelBenchmarkReport.java\n@@ -168,7 +168,7 @@\n     // Here is a mitigation to the lack of support for criteria operators. \"ok\" metric is handled\n     // specifically for the accuracy benchmarking results.\n     // TODO(b/267313326): remove the mitigation after the criteria operators are added.\n-    if (metricName.equals(\"ok\")) {\n+    if (\"ok\".equals(metricName)) {\n       if (testTargetValue == AccuracyBenchmarkReport.PASS) {\n         // The test target delegate passed the accuracy checks.\n         result = BenchmarkResultType.PASS;",
          "changes": [
            {
              "lineNumber": 171,
              "properties": {},
              "description": "Switch order of literals to prevent NullPointerException",
              "diffSide": "left",
              "packageActions": [],
              "parameters": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:java/switch-to-standard-charsets",
      "summary": "Switch to StandardCharsets fields instead of strings",
      "description": "This change removes character set lookups with hardcoded strings like `\"UTF-8\"` in favor of referencing the `StandardCharsets` constants, which were [introduced in Java 7](https://docs.oracle.com/javase/7/docs/api/java/nio/charset/StandardCharsets.html).\n\nThis is faster, more predictable, and will remove the need for handling the `UnsupportedEncodingException`, which makes code easier to reason about. It will also remove IDE and compiler warnings.\n\nOur changes look something like this:\n\n```diff\n  String s = getPropertyValue();\n- byte[] b = s.getBytes(\"UTF-8\");\n+ byte[] b = s.getBytes(StandardCharsets.UTF_8);\n```\n\nNote: Further changes to exception handling may be needed.\n",
      "failedFiles": [],
      "references": [
        {
          "url": "https://community.sonarsource.com/t/use-standardcharsets-instead-of-charset-names/638",
          "description": "https://community.sonarsource.com/t/use-standardcharsets-instead-of-charset-names/638"
        },
        {
          "url": "https://github.com/pmd/pmd/issues/3190",
          "description": "https://github.com/pmd/pmd/issues/3190"
        }
      ],
      "properties": {},
      "changeset": [
        {
          "path": "tensorflow/java/src/main/java/org/tensorflow/GraphOperationBuilder.java",
          "diff": "--- GraphOperationBuilder.java\n+++ GraphOperationBuilder.java\n@@ -16,6 +16,7 @@\n package org.tensorflow;\n \n import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n \n /** An {@link OperationBuilder} for adding {@link GraphOperation}s to a {@link Graph}. */\n public final class GraphOperationBuilder implements OperationBuilder {\n@@ -103,7 +104,7 @@\n \n   @Override\n   public GraphOperationBuilder setAttr(String name, String value) {\n-    setAttr(name, value.getBytes(Charset.forName(\"UTF-8\")));\n+    setAttr(name, value.getBytes(StandardCharsets.UTF_8));\n     return this;\n   }\n \n@@ -281,7 +282,7 @@\n \n   @Override\n   public GraphOperationBuilder setAttr(String name, String[] value) {\n-    Charset utf8 = Charset.forName(\"UTF-8\");\n+    Charset utf8 = StandardCharsets.UTF_8;\n     Object[] objects = new Object[value.length];\n     for (int i = 0; i < value.length; ++i) {\n       objects[i] = value[i].getBytes(utf8);",
          "changes": [
            {
              "lineNumber": 106,
              "properties": {},
              "description": "Switched to pointers instead of String lookups for charset retrieval",
              "diffSide": "left",
              "packageActions": [],
              "parameters": []
            },
            {
              "lineNumber": 284,
              "properties": {},
              "description": "Switched to pointers instead of String lookups for charset retrieval",
              "diffSide": "left",
              "packageActions": [],
              "parameters": []
            }
          ]
        },
        {
          "path": "tensorflow/java/src/main/java/org/tensorflow/examples/LabelImage.java",
          "diff": "--- LabelImage.java\n+++ LabelImage.java\n@@ -18,6 +18,7 @@\n import java.io.IOException;\n import java.io.PrintStream;\n import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n import java.nio.file.Files;\n import java.nio.file.Path;\n import java.nio.file.Paths;\n@@ -149,7 +150,7 @@\n \n   private static List<String> readAllLinesOrExit(Path path) {\n     try {\n-      return Files.readAllLines(path, Charset.forName(\"UTF-8\"));\n+      return Files.readAllLines(path, StandardCharsets.UTF_8);\n     } catch (IOException e) {\n       System.err.println(\"Failed to read [\" + path + \"]: \" + e.getMessage());\n       System.exit(0);",
          "changes": [
            {
              "lineNumber": 152,
              "properties": {},
              "description": "Switched to pointers instead of String lookups for charset retrieval",
              "diffSide": "left",
              "packageActions": [],
              "parameters": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:java/use-empty-for-toarray",
      "summary": "Use empty for Collection#toArray([])",
      "description": "This change updates new array creation with [Collection#toArray(T[])](https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html#toArray-T:A-) to use an empty array argument, which is better for performance.\n\nThe point of the argument is provide an array to hold the objects and be returned, according to the documentation:\n\n> If the collection fits in the specified array, it is returned therein.\n\nAlthough it's not intuitive, allocating a right-sized array ahead of time to pass to the API appears to be [generally worse for performance](https://shipilev.net/blog/2016/arrays-wisdom-ancients/#_conclusion) according to benchmarking and JVM developers due to a number of implementation details in both Java and the virtual machine.   \n \nFor a real world example, consider [this issue in H2](https://github.com/h2database/h2database/issues/311) where significant gains were achieved by switching to an empty array instead of a right-sized one.\n\nOur changes look something like this:\n\n```diff\n- int[] tokenArray = tokens.toArray(new int[tokens.size()]);\n+ int[] tokenArray = tokens.toArray(new int[0]);\n  processTokens(tokenArray);\n```\n",
      "failedFiles": [],
      "references": [
        {
          "url": "https://docs.pmd-code.org/latest/pmd_rules_java_performance.html#optimizabletoarraycall",
          "description": "https://docs.pmd-code.org/latest/pmd_rules_java_performance.html#optimizabletoarraycall"
        },
        {
          "url": "https://shipilev.net/blog/2016/arrays-wisdom-ancients/#_conclusion",
          "description": "https://shipilev.net/blog/2016/arrays-wisdom-ancients/#_conclusion"
        }
      ],
      "properties": {},
      "changeset": [
        {
          "path": "tensorflow/java/src/main/java/org/tensorflow/op/Operands.java",
          "diff": "--- Operands.java\n+++ Operands.java\n@@ -38,7 +38,7 @@\n     for (Operand<?> input : inputs) {\n       outputList.add(input.asOutput());\n     }\n-    return outputList.toArray(new Output<?>[outputList.size()]);\n+    return outputList.toArray(new Output<?>[0]);\n   }\n \n   // Disabled constructor",
          "changes": [
            {
              "lineNumber": 41,
              "properties": {},
              "description": "Use empty for Collection#toArray([])",
              "diffSide": "left",
              "packageActions": [],
              "parameters": []
            }
          ]
        }
      ]
    },
    {
      "codemod": "pixee:java/secure-random",
      "summary": "Introduced protections against predictable RNG abuse",
      "description": "This change replaces all new instances of `java.util.Random` with the marginally slower, but much more secure `java.security.SecureRandom`.\n\nWe have to work pretty hard to get computers to generate genuinely unguessable random bits. The `java.util.Random` type uses a method of pseudo-random number generation that unfortunately emits fairly predictable numbers.\n\nIf the numbers it emits are predictable, then it's obviously not safe to use in cryptographic operations, file name creation, token construction, password generation, and anything else that's related to security. In fact, it may affect security even if it's not directly obvious.\n\nSwitching to a more secure version is simple and our changes all look something like this:\n\n```diff\n- Random r = new Random();\n+ Random r = new java.security.SecureRandom();\n```\n",
      "failedFiles": [],
      "references": [
        {
          "url": "https://owasp.org/www-community/vulnerabilities/Insecure_Randomness",
          "description": "https://owasp.org/www-community/vulnerabilities/Insecure_Randomness"
        },
        {
          "url": "https://metebalci.com/blog/everything-about-javas-securerandom/",
          "description": "https://metebalci.com/blog/everything-about-javas-securerandom/"
        },
        {
          "url": "https://cwe.mitre.org/data/definitions/330.html",
          "description": "https://cwe.mitre.org/data/definitions/330.html"
        }
      ],
      "properties": {},
      "changeset": [
        {
          "path": "tensorflow/lite/java/ovic/src/main/java/org/tensorflow/ovic/OvicValidator.java",
          "diff": "--- OvicValidator.java\n+++ OvicValidator.java\n@@ -23,6 +23,7 @@\n import java.nio.ByteOrder;\n import java.nio.MappedByteBuffer;\n import java.nio.channels.FileChannel;\n+import java.security.SecureRandom;\n import java.util.Random;\n \n /** Validate a submission model. */\n@@ -80,7 +81,7 @@\n   private static ByteBuffer createByteBuffer(int imgWidth, int imgHeight) {\n     ByteBuffer imgData = ByteBuffer.allocateDirect(imgHeight * imgWidth * 3);\n     imgData.order(ByteOrder.nativeOrder());\n-    Random rand = new Random();\n+    Random rand = new SecureRandom();\n     for (int y = 0; y < imgHeight; y++) {\n       for (int x = 0; x < imgWidth; x++) {\n         int val = rand.nextInt();",
          "changes": [
            {
              "lineNumber": 83,
              "properties": {},
              "description": "Replaced the weak pseudo-random number generator with a strong one",
              "diffSide": "left",
              "packageActions": [],
              "parameters": []
            }
          ]
        }
      ]
    }
  ]
}